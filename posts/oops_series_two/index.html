<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    
      <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">

    

    <meta name="author" content="Hello.CC">
    <meta name="description" content="å¼€ç¯‡">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cctrip.tech/posts/oops_series_two/oops-image.jpg"/>
<meta name="twitter:title" content="Oopsç®¡ç†ç³»ç»Ÿ(äºŒ)"/>
<meta name="twitter:description" content="å¼€ç¯‡"/>

    <meta property="og:title" content="Oopsç®¡ç†ç³»ç»Ÿ(äºŒ)" />
<meta property="og:description" content="å¼€ç¯‡" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cctrip.tech/posts/oops_series_two/" /><meta property="og:image" content="https://cctrip.tech/posts/oops_series_two/oops-image.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-20T17:55:28&#43;08:00" />
<meta property="article:modified_time" content="2021-03-20T17:55:28&#43;08:00" />



    <title>
  Oopsç®¡ç†ç³»ç»Ÿ(äºŒ) Â· CC&#39;s Trip
</title>

    
      <link rel="canonical" href="https://cctrip.tech/posts/oops_series_two/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.543dc3579b222ee2eec7bc52e75060428d931ade1c0263624cf4be95f0f467a2.css" integrity="sha256-VD3DV5siLuLux7xS51BgQo2TGt4cAmNiTPS&#43;lfD0Z6I=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.92eafdad7963af697840da26de3829cd3610aa623b917f6c37fb3f81e404b693.css" integrity="sha256-kur9rXljr2l4QNom3jgpzTYQqmI7kX9sN/s/geQEtpM=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/leo.png" sizes="32x32">
    

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.81.0" />
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto">
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      CC&#39;s Trip
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/contact/">Contact me</a>
            </li>
          
        
        
          
          
          
            
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://cctrip.tech/zh-cn/">ğŸ‡¨ğŸ‡³</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://cctrip.tech/posts/oops_series_two/">
              Oopsç®¡ç†ç³»ç»Ÿ(äºŒ)
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2021-03-20T17:55:28&#43;08:00'>
                March 20, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              9-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="/categories/devops/">DevOps</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/devops/">devops</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/platform/">platform</a>
    </span></div>

        </div>
      </header>

      <div>
        
        <h2 id="ç³»åˆ—ç›®å½•">
  ç³»åˆ—ç›®å½•
  <a class="heading-link" href="#%e7%b3%bb%e5%88%97%e7%9b%ae%e5%bd%95">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p><a href="../oops_series_one">ã€ŠOopsç®¡ç†ç³»ç»Ÿ(ä¸€)ã€‹</a></p>
<p><a href="../oops_series_two">ã€ŠOopsç®¡ç†ç³»ç»Ÿ(äºŒ)ã€‹</a></p>
<hr>
<h2 id="1-ä»‹ç»">
  1. ä»‹ç»
  <a class="heading-link" href="#1-%e4%bb%8b%e7%bb%8d">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>æœ¬ç¯‡ï¼Œè¦å…ˆè®²ä¸‹æ•´ä½“çš„æŠ€æœ¯æ¡†æ¶ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäºgo-adminè¿™ä¸ªè„šæ‰‹æ¶æ¥åšå‰åç«¯æ¡†æ¶çš„ï¼Œæ‰€ä»¥ï¼Œå…ˆæ¥è¯´æ˜ä¸‹æ•´ä¸ªä»£ç æ¶æ„ã€‚</p>
<p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•è¯´æ˜ä¸‹goç¨‹åºçš„ä»£ç æ‰§è¡Œé¡ºåº</p>
<h3 id="11-goç¨‹åºæ‰§è¡Œé¡ºåº">
  1.1 Goç¨‹åºæ‰§è¡Œé¡ºåº
  <a class="heading-link" href="#11-go%e7%a8%8b%e5%ba%8f%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p><img src="go-order.jpg" alt=""></p>
<ul>
<li>æ‰§è¡Œ<code>go run</code>æˆ–è€…ç¼–è¯‘å<code>binary</code>æ–‡ä»¶æ—¶ï¼Œä¼šå…ˆåŠ è½½<code>main package</code></li>
<li><code>main package</code>ä¸€èˆ¬ä¼š<code>import</code>å…¶ä»–<code>package</code>ï¼Œå…¶ä»–<code>package</code>ä¹Ÿä¼š<code>import</code>å…¶ä¾èµ–çš„<code>package</code>ï¼Œè¿™è¾¹ä¼šæœ‰ä¸€ä¸ªé€’å½’çš„åˆå§‹åŒ–æ“ä½œã€‚</li>
<li><code>package</code>ä¼šæ‰§è¡Œ<code>global variables</code>å’Œ<code>init()</code>çš„åˆå§‹åŒ–</li>
<li><code>main package</code>æ‰§è¡Œæœ¬èº«çš„<code>global variables</code>å’Œ<code>init()</code>çš„åˆå§‹åŒ–</li>
<li>æ‰§è¡Œ<code>main()</code></li>
</ul>
<hr>
<h2 id="2-ç›®å½•ç»“æ„">
  2. ç›®å½•ç»“æ„
  <a class="heading-link" href="#2-%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>OopsåŸºäº<a href="https://github.com/golang-standards/project-layout">project-layout</a>å’Œ<a href="">go-admin</a>æ„å»ºäº†å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç›®å½•ç»“æ„</p>
<p><img src="project-layout.jpg" alt=""></p>
<hr>
<h2 id="3-æºç è§£æ">
  3. æºç è§£æ
  <a class="heading-link" href="#3-%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>è¿™è¾¹åªè¯´æ˜åº”ç”¨ç›¸å…³çš„æºç é€»è¾‘ã€‚</p>
<h3 id="31-ç³»ç»Ÿåˆå§‹åŒ–">
  3.1 ç³»ç»Ÿåˆå§‹åŒ–
  <a class="heading-link" href="#31-%e7%b3%bb%e7%bb%9f%e5%88%9d%e5%a7%8b%e5%8c%96">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p><strong>main.go</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> (
	<span style="color:#2aa198">&#34;oops/cmd&#34;</span>
)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
	cmd.<span style="color:#268bd2">Execute</span>()
}
</code></pre></div><p>mainå‡½æ•°åªæœ‰ä¸€ä¸ªé€»è¾‘ï¼ŒåŠ è½½cmdåŒ…ä»¥åŠæ‰§è¡ŒcmdåŒ…ä¸­çš„Execute()å‡½æ•°ã€‚</p>
<p><strong>cmd package</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> cmd

<span style="color:#719e07">import</span> (
	<span style="color:#719e07">...</span>
	<span style="color:#2aa198">&#34;oops/internal/common/global&#34;</span>
	<span style="color:#2aa198">&#34;github.com/spf13/cobra&#34;</span>
	<span style="color:#2aa198">&#34;oops/cmd/api&#34;</span>
	<span style="color:#719e07">...</span>
)

<span style="color:#268bd2">var</span> rootCmd = <span style="color:#719e07">&amp;</span>cobra.Command{
	<span style="color:#719e07">...</span>
}

<span style="color:#719e07">...</span>

<span style="color:#268bd2">func</span> <span style="color:#268bd2">init</span>() {
  <span style="color:#719e07">...</span>
	rootCmd.<span style="color:#268bd2">AddCommand</span>(api.StartCmd)
	<span style="color:#719e07">...</span>
}

<span style="color:#586e75">//Execute : apply commands
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">Execute</span>() {
	<span style="color:#719e07">if</span> err <span style="color:#719e07">:=</span> rootCmd.<span style="color:#268bd2">Execute</span>(); err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		os.<span style="color:#268bd2">Exit</span>(<span style="color:#719e07">-</span><span style="color:#2aa198">1</span>)
	}
}

</code></pre></div><p>è¿™è¾¹ç”¨åˆ°äº†ä¸€ä¸ªcobraçš„å‘½ä»¤è¡Œæ¡†æ¶ï¼Œä»¥åŠåŠ è½½apiçš„ç›¸å…³é€»è¾‘ã€‚</p>
<p><strong>cmd/api</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> api

<span style="color:#719e07">import</span> (
	<span style="color:#719e07">...</span>
	<span style="color:#2aa198">&#34;github.com/spf13/cobra&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/app/admin/router&#34;</span>
	<span style="color:#719e07">...</span>
)

<span style="color:#268bd2">var</span> (
	configYml <span style="color:#dc322f">string</span>
	StartCmd  = <span style="color:#719e07">&amp;</span>cobra.Command{
		Use:          <span style="color:#2aa198">&#34;server&#34;</span>,
		Short:        <span style="color:#2aa198">&#34;Start API server&#34;</span>,
		Example:      <span style="color:#2aa198">&#34;go-admin server -c config/settings.yml&#34;</span>,
		SilenceUsage: <span style="color:#cb4b16">true</span>,
		PreRun: <span style="color:#268bd2">func</span>(cmd <span style="color:#719e07">*</span>cobra.Command, args []<span style="color:#dc322f">string</span>) {
			<span style="color:#268bd2">setup</span>()
		},
		RunE: <span style="color:#268bd2">func</span>(cmd <span style="color:#719e07">*</span>cobra.Command, args []<span style="color:#dc322f">string</span>) <span style="color:#dc322f">error</span> {
			<span style="color:#719e07">return</span> <span style="color:#268bd2">run</span>()
		},
	}
)

<span style="color:#268bd2">var</span> AppRouters = <span style="color:#b58900">make</span>([]<span style="color:#268bd2">func</span>(), <span style="color:#2aa198">0</span>)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">init</span>() {
	<span style="color:#719e07">...</span>
	<span style="color:#586e75">//æ³¨å†Œè·¯ç”± fixme å…¶ä»–åº”ç”¨çš„è·¯ç”±ï¼Œåœ¨æœ¬ç›®å½•æ–°å»ºæ–‡ä»¶æ”¾åœ¨initæ–¹æ³•
</span><span style="color:#586e75"></span>	AppRouters = <span style="color:#b58900">append</span>(AppRouters, router.InitRouter)
}

<span style="color:#268bd2">func</span> <span style="color:#268bd2">setup</span>() {

	<span style="color:#586e75">//1. è¯»å–é…ç½®
</span><span style="color:#586e75"></span>	<span style="color:#719e07">...</span>
	<span style="color:#586e75">//2. è®¾ç½®æ—¥å¿—
</span><span style="color:#586e75"></span>	<span style="color:#719e07">...</span>
	<span style="color:#586e75">//3. åˆå§‹åŒ–æ•°æ®åº“é“¾æ¥
</span><span style="color:#586e75"></span>	<span style="color:#719e07">...</span>
}

<span style="color:#268bd2">func</span> <span style="color:#268bd2">run</span>() <span style="color:#dc322f">error</span> {
	<span style="color:#586e75">//è¿è¡ŒhttpæœåŠ¡
</span><span style="color:#586e75"></span>  <span style="color:#719e07">...</span>
	<span style="color:#719e07">return</span> <span style="color:#cb4b16">nil</span>
}

</code></pre></div><p>è¿™é‡Œè¿›è¡Œäº†æ³¨å†Œè·¯ç”±çš„æ“ä½œï¼Œå¹¶è¯»å–é…ç½®ï¼Œå¯¹æ—¥å¿—ã€æ•°æ®åº“ä»¥åŠhttp serverè¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<p><strong>internal/app/admin/router</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> router

<span style="color:#719e07">import</span> (
	<span style="color:#719e07">...</span>
	<span style="color:#2aa198">&#34;github.com/gin-gonic/gin&#34;</span>
	log <span style="color:#2aa198">&#34;github.com/go-admin-team/go-admin-core/logger&#34;</span>

	<span style="color:#2aa198">&#34;oops/internal/app/admin/middleware&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/app/admin/middleware/handler&#34;</span>
	common <span style="color:#2aa198">&#34;oops/internal/common/middleware&#34;</span>

	<span style="color:#719e07">...</span>
)

<span style="color:#586e75">// InitRouter è·¯ç”±åˆå§‹åŒ–ï¼Œä¸è¦æ€€ç–‘ï¼Œè¿™é‡Œç”¨åˆ°äº†
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">InitRouter</span>() {
	<span style="color:#719e07">...</span>
	middleware.<span style="color:#268bd2">InitMiddleware</span>(r)
	<span style="color:#586e75">// the jwt middleware
</span><span style="color:#586e75"></span>	authMiddleware, err <span style="color:#719e07">:=</span> middleware.<span style="color:#268bd2">AuthInit</span>()
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Fatalf</span>(<span style="color:#2aa198">&#34;JWT Init Error, %s&#34;</span>, err.<span style="color:#268bd2">Error</span>())
	}

	<span style="color:#586e75">// æ³¨å†Œç³»ç»Ÿè·¯ç”±
</span><span style="color:#586e75"></span>	<span style="color:#268bd2">InitSysRouter</span>(r, authMiddleware)

	<span style="color:#586e75">// æ³¨å†Œä¸šåŠ¡è·¯ç”±
</span><span style="color:#586e75"></span>	<span style="color:#586e75">// TODO: è¿™é‡Œå¯å­˜æ”¾ä¸šåŠ¡è·¯ç”±ï¼Œé‡Œè¾¹å¹¶æ— å®é™…è·¯ç”±åªæœ‰æ¼”ç¤ºä»£ç 
</span><span style="color:#586e75"></span>	<span style="color:#268bd2">InitExamplesRouter</span>(r, authMiddleware)
}


<span style="color:#268bd2">var</span> (
	routerNoCheckRole = <span style="color:#b58900">make</span>([]<span style="color:#268bd2">func</span>(<span style="color:#719e07">*</span>gin.RouterGroup), <span style="color:#2aa198">0</span>)
	routerCheckRole   = <span style="color:#b58900">make</span>([]<span style="color:#268bd2">func</span>(v1 <span style="color:#719e07">*</span>gin.RouterGroup, authMiddleware <span style="color:#719e07">*</span>jwt.GinJWTMiddleware), <span style="color:#2aa198">0</span>)
)

<span style="color:#586e75">// è·¯ç”±ç¤ºä¾‹
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">InitExamplesRouter</span>(r <span style="color:#719e07">*</span>gin.Engine, authMiddleware <span style="color:#719e07">*</span>jwt.GinJWTMiddleware) <span style="color:#719e07">*</span>gin.Engine {

	<span style="color:#586e75">// æ— éœ€è®¤è¯çš„è·¯ç”±
</span><span style="color:#586e75"></span>	<span style="color:#268bd2">examplesNoCheckRoleRouter</span>(r)
	<span style="color:#586e75">// éœ€è¦è®¤è¯çš„è·¯ç”±
</span><span style="color:#586e75"></span>	<span style="color:#268bd2">examplesCheckRoleRouter</span>(r, authMiddleware)

	<span style="color:#719e07">return</span> r
}

<span style="color:#586e75">// æ— éœ€è®¤è¯çš„è·¯ç”±ç¤ºä¾‹
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">examplesNoCheckRoleRouter</span>(r <span style="color:#719e07">*</span>gin.Engine) {
	<span style="color:#586e75">// å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥è®¾ç½®æ¥å£ç‰ˆæœ¬
</span><span style="color:#586e75"></span>	v1 <span style="color:#719e07">:=</span> r.<span style="color:#268bd2">Group</span>(<span style="color:#2aa198">&#34;/api/v1&#34;</span>)
	<span style="color:#586e75">// ç©ºæ¥å£é˜²æ­¢v1å®šä¹‰æ— ä½¿ç”¨æŠ¥é”™
</span><span style="color:#586e75"></span>	v1.<span style="color:#268bd2">GET</span>(<span style="color:#2aa198">&#34;/nilcheckrole&#34;</span>, <span style="color:#cb4b16">nil</span>)

	<span style="color:#719e07">for</span> _, f <span style="color:#719e07">:=</span> <span style="color:#719e07">range</span> routerNoCheckRole {
		<span style="color:#268bd2">f</span>(v1)
	}

	<span style="color:#586e75">// {{æ— éœ€è®¤è¯è·¯ç”±è‡ªåŠ¨è¡¥å……åœ¨æ­¤å¤„è¯·å‹¿åˆ é™¤}}
</span><span style="color:#586e75"></span>	<span style="color:#586e75">//registerSysFileInfoRouter(v1)
</span><span style="color:#586e75"></span>}

<span style="color:#586e75">// éœ€è¦è®¤è¯çš„è·¯ç”±ç¤ºä¾‹
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">examplesCheckRoleRouter</span>(r <span style="color:#719e07">*</span>gin.Engine, authMiddleware <span style="color:#719e07">*</span>jwtauth.GinJWTMiddleware) {
	<span style="color:#586e75">// å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥è®¾ç½®æ¥å£ç‰ˆæœ¬
</span><span style="color:#586e75"></span>	v1 <span style="color:#719e07">:=</span> r.<span style="color:#268bd2">Group</span>(<span style="color:#2aa198">&#34;/api/v1&#34;</span>)
	<span style="color:#586e75">// ç©ºæ¥å£é˜²æ­¢v1å®šä¹‰æ— ä½¿ç”¨æŠ¥é”™
</span><span style="color:#586e75"></span>	v1.<span style="color:#268bd2">GET</span>(<span style="color:#2aa198">&#34;/checkrole&#34;</span>, <span style="color:#cb4b16">nil</span>)

	<span style="color:#719e07">for</span> _, f <span style="color:#719e07">:=</span> <span style="color:#719e07">range</span> routerCheckRole {
		<span style="color:#268bd2">f</span>(v1, authMiddleware)
	}
}

</code></pre></div><p>è¿™é‡Œé¢å®ç°äº†å…·ä½“çš„è·¯ç”±æ³¨å†Œæ¥å£é€»è¾‘ï¼Œåç»­æ–°å¢çš„ä¸šåŠ¡è·¯ç”±æ³¨å†Œåªéœ€è¦å¾€<code>routerCheckRole</code>å’Œ<code>routerNoCheckRole</code>å˜é‡ä¸­æ’å…¥æ•°æ®å³å¯ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#268bd2">func</span> <span style="color:#268bd2">init</span>() {
	routerCheckRole = <span style="color:#b58900">append</span>(routerCheckRole, registerApplicationRouter)
}

<span style="color:#586e75">// éœ€è®¤è¯çš„è·¯ç”±ä»£ç 
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">registerApplicationRouter</span>(v1 <span style="color:#719e07">*</span>gin.RouterGroup, authMiddleware <span style="color:#719e07">*</span>jwt.GinJWTMiddleware) {
	api <span style="color:#719e07">:=</span> <span style="color:#719e07">&amp;</span>cmdb.Application{}
	r <span style="color:#719e07">:=</span> v1.<span style="color:#268bd2">Group</span>(<span style="color:#2aa198">&#34;/cmdb/application&#34;</span>).<span style="color:#268bd2">Use</span>(authMiddleware.<span style="color:#268bd2">MiddlewareFunc</span>()).<span style="color:#268bd2">Use</span>(middleware2.<span style="color:#268bd2">AuthCheckRole</span>()).<span style="color:#268bd2">Use</span>(actions.<span style="color:#268bd2">PermissionAction</span>())
	{
		r.<span style="color:#268bd2">GET</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.GetApplicationList)
		r.<span style="color:#268bd2">GET</span>(<span style="color:#2aa198">&#34;/:id&#34;</span>, api.GetApplication)
		r.<span style="color:#268bd2">POST</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.InsertApplication)
		r.<span style="color:#268bd2">PUT</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.UpdateApplication)
		r.<span style="color:#268bd2">DELETE</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.DeleteApplication)
	}
}
</code></pre></div><p>è¯¥ä¾‹å­å°†åº”ç”¨ç›¸å…³çš„è·¯ç”±ä¿¡æ¯æ·»åŠ åˆ°äº†<code>routerCheckRole</code>é‡Œé¢ã€‚</p>
<hr>
<h3 id="32-å®šä¹‰ä¸€ä¸ªä¸šåŠ¡">
  3.2 å®šä¹‰ä¸€ä¸ªä¸šåŠ¡
  <a class="heading-link" href="#32-%e5%ae%9a%e4%b9%89%e4%b8%80%e4%b8%aa%e4%b8%9a%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p><strong>internal/app</strong></p>
<p>ç›®å½•ç»“æ„è¯´æ˜</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">.
â”œâ”€â”€ admin
â”‚   â”œâ”€â”€ apis
â”‚   â”‚   â”œâ”€â”€ cmdb
â”‚   â”‚   â”‚   â””â”€â”€ application.go
â”‚   â”œâ”€â”€ middleware
â”‚   â”œâ”€â”€ models
â”‚   â”‚   â”œâ”€â”€ cmdb
â”‚   â”‚   â”‚   â””â”€â”€ application.go
â”‚   â”œâ”€â”€ router
â”‚   â”‚   â”œâ”€â”€ cmdb.go
â”‚   â”‚   â”œâ”€â”€ router.go
â”‚   â””â”€â”€ service
â”‚       â”œâ”€â”€ cmdb
â”‚       â”‚   â”œâ”€â”€ application.go
â”‚       â”‚   â”œâ”€â”€ dto
â”‚       â”‚   â”‚		â”œâ”€â”€ application.go
</code></pre></div><p>adminï¼šå¯ä»¥ç†è§£æˆä¸€ä¸ªproject</p>
<p>apis.cmdbï¼šæ˜¯projectçš„apiæ–‡ä»¶</p>
<p>middlewareï¼šæ˜¯projectçš„ä¸­é—´ä»¶</p>
<p>models.cmdbï¼šæ˜¯projectçš„æ•°æ®åº“å±‚çš„æ¨¡å‹</p>
<p>routerï¼šæ˜¯projectçš„è·¯ç”±</p>
<p>service.cmdbï¼šæ˜¯projectçš„ä¸šåŠ¡é€»è¾‘å¤„ç†</p>
<p>service.cmdb.dtoï¼šæ˜¯projectçš„apiå¯¹åº”çš„æ•°æ®æ¥æ”¶ä»¥åŠè§£ææ¨¡å‹</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŒ‰ç…§ modelsã€service.dtoã€serviceã€apisã€routerè¿™ä¸ªé¡ºåºæ¥è¯´æ˜ï¼›</p>
<p><strong>models</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> cmdb

<span style="color:#719e07">import</span> (
	<span style="color:#2aa198">&#34;oops/internal/app/admin/models/system&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/models&#34;</span>
)

<span style="color:#268bd2">type</span> Application <span style="color:#268bd2">struct</span> {
	models.ControlBy
	models.ModelTime
	AppId    <span style="color:#dc322f">int</span>             <span style="color:#2aa198">`gorm:&#34;primaryKey;autoIncrement;comment:åº”ç”¨ID&#34;  json:&#34;appId&#34;`</span>
	AppName  <span style="color:#dc322f">string</span>          <span style="color:#2aa198">`json:&#34;appName&#34; gorm:&#34;type:varchar(64);comment:åº”ç”¨åç§°&#34;`</span>
	Language <span style="color:#dc322f">string</span>          <span style="color:#2aa198">`json:&#34;language&#34; gorm:&#34;type:varchar(128);comment:è¯­è¨€&#34;`</span>
	Repo     <span style="color:#dc322f">string</span>          <span style="color:#2aa198">`json:&#34;repo&#34; gorm:&#34;type:varchar(128);comment:ä»£ç ä»“åº“&#34;`</span>
	DeptId   <span style="color:#dc322f">int</span>             <span style="color:#2aa198">`json:&#34;deptId&#34; gorm:&#34;type:bigint(20);comment:éƒ¨é—¨&#34;`</span>
	UserId   <span style="color:#dc322f">int</span>             <span style="color:#2aa198">`json:&#34;userId&#34; gorm:&#34;type:bigint(20);comment:ç”¨æˆ·&#34;`</span>
	Remark   <span style="color:#dc322f">string</span>          <span style="color:#2aa198">`json:&#34;remark&#34; gorm:&#34;type:varchar(255);comment:å¤‡æ³¨&#34;`</span>
	Status   <span style="color:#dc322f">string</span>          <span style="color:#2aa198">`json:&#34;status&#34; gorm:&#34;type:varchar(4);comment:çŠ¶æ€&#34;`</span>
	Dept     <span style="color:#719e07">*</span>system.SysDept <span style="color:#2aa198">`json:&#34;dept&#34;`</span>
	User     <span style="color:#719e07">*</span>system.SysUser <span style="color:#2aa198">`json:&#34;user&#34;`</span>
}

<span style="color:#268bd2">func</span> (Application) <span style="color:#268bd2">TableName</span>() <span style="color:#dc322f">string</span> {
	<span style="color:#719e07">return</span> <span style="color:#2aa198">&#34;application&#34;</span>
}

<span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">Generate</span>() models.ActiveRecord {
	o <span style="color:#719e07">:=</span> <span style="color:#719e07">*</span>e
	<span style="color:#719e07">return</span> <span style="color:#719e07">&amp;</span>o
}

<span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">GetId</span>() <span style="color:#268bd2">interface</span>{} {
	<span style="color:#719e07">return</span> e.AppId
}

</code></pre></div><p>é¦–å…ˆï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“<code>Application</code>é‡Œè¾¹å«æœ‰æ­£å¸¸çš„æ•°æ®åº“è¡¨å­—æ®µï¼Œä½†æ˜¯å…¶ä¸­åˆåŒ…å«äº†ä¸‰ä¸ªç»“æ„ä½“ï¼š</p>
<p>1ã€<code>models.Model</code> è¡¨id é»˜è®¤ä¸»é”®æ˜¯å›ºå®šçš„IDå’Œè‡ªå¢é•¿çš„intç±»å‹</p>
<p>2ã€<code>models.ControlBy</code> è¡¨åˆ›å»ºäººå’Œä¿®æ”¹äºº æ•°æ®åº“è¡¨é»˜è®¤å¿…æœ‰å­—æ®µ</p>
<p>3ã€<code>models.ModelTime</code> è¡¨åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´ã€åˆ é™¤æ—¶é—´çš„å­—æ®µé»˜è®¤å¿…æœ‰å­—æ®µ</p>
<p><strong>dto</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> dto

<span style="color:#719e07">import</span> (
	<span style="color:#2aa198">&#34;oops/internal/common/apis&#34;</span>

	<span style="color:#2aa198">&#34;github.com/gin-gonic/gin&#34;</span>

	<span style="color:#2aa198">&#34;oops/internal/app/admin/models/cmdb&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/dto&#34;</span>
	common <span style="color:#2aa198">&#34;oops/internal/common/models&#34;</span>
)
<span style="color:#586e75">// ApplicationSearch æœç´¢åˆ—è¡¨å¯¹åº”çš„æ•°æ®æ¥æ”¶æ¨¡å‹ ä¸»è¦é’ˆå¯¹åˆ†é¡µã€åˆ—è¡¨ï¼›
</span><span style="color:#586e75"></span><span style="color:#268bd2">type</span> ApplicationSearch <span style="color:#268bd2">struct</span> {
	dto.Pagination <span style="color:#2aa198">`search:&#34;-&#34;`</span>
	AppId          <span style="color:#dc322f">int</span>    <span style="color:#2aa198">`form:&#34;AppId&#34; search:&#34;type:exact;column:app_id;table:application&#34; comment:&#34;åº”ç”¨ID&#34;`</span>
	AppName        <span style="color:#dc322f">string</span> <span style="color:#2aa198">`form:&#34;appName&#34; search:&#34;type:contains;column:app_name;table:application&#34; comment:&#34;åº”ç”¨åç§°&#34;`</span>
	Language       <span style="color:#dc322f">string</span> <span style="color:#2aa198">`form:&#34;language&#34; search:&#34;type:contains;column:language;table:application&#34; comment:&#34;è¯­è¨€&#34;`</span>
	Repo           <span style="color:#dc322f">string</span> <span style="color:#2aa198">`form:&#34;repo&#34; search:&#34;type:contains;column:repo;table:application&#34; comment:&#34;ä»“åº“åœ°å€&#34;`</span>
	DeptId         <span style="color:#dc322f">string</span> <span style="color:#2aa198">`form:&#34;deptId&#34; search:&#34;type:exact;column:dept_id;table:application&#34; comment:&#34;éƒ¨é—¨&#34;`</span>
	UserId         <span style="color:#dc322f">string</span> <span style="color:#2aa198">`form:&#34;userId&#34; search:&#34;type:exact;column:user_id;table:application&#34; comment:&#34;ç”¨æˆ·&#34;`</span>
	Status         <span style="color:#dc322f">string</span> <span style="color:#2aa198">`form:&#34;status&#34; search:&#34;type:exact;column:status;table:application&#34; comment:&#34;çŠ¶æ€&#34;`</span>
}

<span style="color:#586e75">// GetNeedSearch å°†search è½¬åŒ–ä¸ºinterface
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (m <span style="color:#719e07">*</span>ApplicationSearch) <span style="color:#268bd2">GetNeedSearch</span>() <span style="color:#268bd2">interface</span>{} {
	<span style="color:#719e07">return</span> <span style="color:#719e07">*</span>m
}

<span style="color:#586e75">// Bind ä»ä¸Šä¸‹æ–‡ä¸­è§£ææ•°æ®
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (m <span style="color:#719e07">*</span>ApplicationSearch) <span style="color:#268bd2">Bind</span>(ctx <span style="color:#719e07">*</span>gin.Context) <span style="color:#dc322f">error</span> {
	log <span style="color:#719e07">:=</span> apis.<span style="color:#268bd2">GetRequestLogger</span>(ctx)
	err <span style="color:#719e07">:=</span> ctx.<span style="color:#268bd2">ShouldBind</span>(m)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Debugf</span>(<span style="color:#2aa198">&#34;ShouldBind error: %s&#34;</span>, err.<span style="color:#268bd2">Error</span>())
	}
	<span style="color:#719e07">return</span> err
}
<span style="color:#586e75">// Generate å°†æ•°æ®è½¬åŒ–æˆæ•°æ®åº“ä½¿ç”¨çš„ç»“æ„ä½“
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (m <span style="color:#719e07">*</span>ApplicationSearch) <span style="color:#268bd2">Generate</span>() dto.Index {
	o <span style="color:#719e07">:=</span> <span style="color:#719e07">*</span>m
	<span style="color:#719e07">return</span> <span style="color:#719e07">&amp;</span>o
}

<span style="color:#586e75">// ApplicationControl åˆ›å»ºã€ä¿®æ”¹ä½¿ç”¨çš„æ•°æ®æ¥æ”¶æ¨¡å‹
</span><span style="color:#586e75"></span><span style="color:#268bd2">type</span> ApplicationControl <span style="color:#268bd2">struct</span> {
	AppId    <span style="color:#dc322f">int</span>    <span style="color:#2aa198">`json:&#34;appId&#34; comment:åº”ç”¨ID&#34;`</span>
	AppName  <span style="color:#dc322f">string</span> <span style="color:#2aa198">`json:&#34;appName&#34; comment:åº”ç”¨åç§°&#34;`</span>
	Language <span style="color:#dc322f">string</span> <span style="color:#2aa198">`json:&#34;language&#34; comment:è¯­è¨€&#34;`</span>
	Repo     <span style="color:#dc322f">string</span> <span style="color:#2aa198">`json:&#34;repo&#34; comment:ä»£ç ä»“åº“&#34;`</span>
	DeptId   <span style="color:#dc322f">int</span>    <span style="color:#2aa198">`json:&#34;deptId&#34; comment:éƒ¨é—¨&#34;`</span>
	UserId   <span style="color:#dc322f">int</span>    <span style="color:#2aa198">`json:&#34;userId&#34; comment:ç”¨æˆ·&#34;`</span>
	Remark   <span style="color:#dc322f">string</span> <span style="color:#2aa198">`json:&#34;remark&#34; comment:å¤‡æ³¨&#34;`</span>
	Status   <span style="color:#dc322f">string</span> <span style="color:#2aa198">`json:&#34;status&#34; comment:çŠ¶æ€&#34;`</span>
}

<span style="color:#586e75">// Bind ä»ä¸Šä¸‹æ–‡ä¸­è§£ææ•°æ®
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (a <span style="color:#719e07">*</span>ApplicationControl) <span style="color:#268bd2">Bind</span>(ctx <span style="color:#719e07">*</span>gin.Context) <span style="color:#dc322f">error</span> {
	log <span style="color:#719e07">:=</span> apis.<span style="color:#268bd2">GetRequestLogger</span>(ctx)
	<span style="color:#586e75">//err := ctx.ShouldBindUri(s)
</span><span style="color:#586e75"></span>	<span style="color:#586e75">//if err != nil {
</span><span style="color:#586e75"></span>	<span style="color:#586e75">//	log.Debugf(&#34;ShouldBindUri error: %s&#34;, err.Error())
</span><span style="color:#586e75"></span>	<span style="color:#586e75">//	return err
</span><span style="color:#586e75"></span>	<span style="color:#586e75">//}
</span><span style="color:#586e75"></span>	err <span style="color:#719e07">:=</span> ctx.<span style="color:#268bd2">ShouldBind</span>(a)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Debugf</span>(<span style="color:#2aa198">&#34;ShouldBind error: %s&#34;</span>, err.<span style="color:#268bd2">Error</span>())
	}
	<span style="color:#719e07">return</span> err
}

<span style="color:#586e75">// Generate å°†æ•°æ®è½¬åŒ–æˆæ•°æ®åº“ä½¿ç”¨çš„ç»“æ„ä½“
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (a <span style="color:#719e07">*</span>ApplicationControl) <span style="color:#268bd2">Generate</span>() dto.Control {
	cp <span style="color:#719e07">:=</span> <span style="color:#719e07">*</span>a
	<span style="color:#719e07">return</span> <span style="color:#719e07">&amp;</span>cp
}

<span style="color:#268bd2">func</span> (a <span style="color:#719e07">*</span>ApplicationControl) <span style="color:#268bd2">GenerateM</span>() (common.ActiveRecord, <span style="color:#dc322f">error</span>) {
	<span style="color:#719e07">return</span> <span style="color:#719e07">&amp;</span>cmdb.Application{
		AppId:    a.AppId,
		AppName:  a.AppName,
		Language: a.Language,
		Repo:     a.Repo,
		DeptId:   a.DeptId,
		UserId:   a.UserId,
		Remark:   a.Remark,
		Status:   a.Status,
	}, <span style="color:#cb4b16">nil</span>
}

<span style="color:#586e75">// GetId è·å–id
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (s <span style="color:#719e07">*</span>ApplicationControl) <span style="color:#268bd2">GetId</span>() <span style="color:#268bd2">interface</span>{} {
	<span style="color:#719e07">return</span> s.AppId
}

<span style="color:#586e75">// ApplicationById é€šè¿‡idæŸ¥è¯¢ã€åˆ é™¤ç­‰ä½¿ç”¨çš„æ¨¡å‹
</span><span style="color:#586e75"></span><span style="color:#268bd2">type</span> ApplicationById <span style="color:#268bd2">struct</span> {
	dto.ObjectById
}

<span style="color:#268bd2">func</span> (s <span style="color:#719e07">*</span>ApplicationById) <span style="color:#268bd2">Generate</span>() dto.Control {
	cp <span style="color:#719e07">:=</span> <span style="color:#719e07">*</span>s
	<span style="color:#719e07">return</span> <span style="color:#719e07">&amp;</span>cp
}

<span style="color:#268bd2">func</span> (s <span style="color:#719e07">*</span>ApplicationById) <span style="color:#268bd2">GenerateM</span>() (common.ActiveRecord, <span style="color:#dc322f">error</span>) {
	<span style="color:#719e07">return</span> <span style="color:#719e07">&amp;</span>cmdb.Application{}, <span style="color:#cb4b16">nil</span>
}
</code></pre></div><p><strong>service</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#719e07">package</span> cmdb

<span style="color:#719e07">import</span> (
	<span style="color:#2aa198">&#34;errors&#34;</span>

	<span style="color:#2aa198">&#34;gorm.io/gorm&#34;</span>

	<span style="color:#2aa198">&#34;oops/internal/app/admin/models/cmdb&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/actions&#34;</span>
	cDto <span style="color:#2aa198">&#34;oops/internal/common/dto&#34;</span>
	common <span style="color:#2aa198">&#34;oops/internal/common/models&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/service&#34;</span>
)

<span style="color:#268bd2">type</span> Application <span style="color:#268bd2">struct</span> {
	service.Service
}

<span style="color:#586e75">// GetApplicationPage è·å–Applicationåˆ—è¡¨
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">GetApplicationPage</span>(c cDto.Index, p <span style="color:#719e07">*</span>actions.DataPermission, list <span style="color:#719e07">*</span>[]cmdb.Application, count <span style="color:#719e07">*</span><span style="color:#dc322f">int64</span>) <span style="color:#dc322f">error</span> {
	<span style="color:#268bd2">var</span> err <span style="color:#dc322f">error</span>
	<span style="color:#268bd2">var</span> data cmdb.Application

	err = e.Orm.<span style="color:#268bd2">Model</span>(<span style="color:#719e07">&amp;</span>data).
		<span style="color:#268bd2">Scopes</span>(
			cDto.<span style="color:#268bd2">MakeCondition</span>(c.<span style="color:#268bd2">GetNeedSearch</span>()),
			cDto.<span style="color:#268bd2">Paginate</span>(c.<span style="color:#268bd2">GetPageSize</span>(), c.<span style="color:#268bd2">GetPageIndex</span>()),
			actions.<span style="color:#268bd2">Permission</span>(data.<span style="color:#268bd2">TableName</span>(), p),
		).
		<span style="color:#586e75">//Preload(&#34;Dept&#34;).
</span><span style="color:#586e75"></span>		<span style="color:#268bd2">Find</span>(list).<span style="color:#268bd2">Limit</span>(<span style="color:#719e07">-</span><span style="color:#2aa198">1</span>).<span style="color:#268bd2">Offset</span>(<span style="color:#719e07">-</span><span style="color:#2aa198">1</span>).
		<span style="color:#268bd2">Count</span>(count).Error
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.Log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;db error: %s&#34;</span>, err)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">return</span> <span style="color:#cb4b16">nil</span>
}

<span style="color:#586e75">// GetApplication è·å–Applicationå¯¹è±¡
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">GetApplication</span>(d cDto.Control, p <span style="color:#719e07">*</span>actions.DataPermission, model <span style="color:#719e07">*</span>cmdb.Application) <span style="color:#dc322f">error</span> {
	<span style="color:#268bd2">var</span> err <span style="color:#dc322f">error</span>
	<span style="color:#268bd2">var</span> data cmdb.Application

	db <span style="color:#719e07">:=</span> e.Orm.<span style="color:#268bd2">Model</span>(<span style="color:#719e07">&amp;</span>data).
		<span style="color:#268bd2">Scopes</span>(
			actions.<span style="color:#268bd2">Permission</span>(data.<span style="color:#268bd2">TableName</span>(), p),
		).
		<span style="color:#268bd2">First</span>(model, d.<span style="color:#268bd2">GetId</span>())
	err = db.Error
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> <span style="color:#719e07">&amp;&amp;</span> errors.<span style="color:#268bd2">Is</span>(err, gorm.ErrRecordNotFound) {
		err = errors.<span style="color:#268bd2">New</span>(<span style="color:#2aa198">&#34;æŸ¥çœ‹å¯¹è±¡ä¸å­˜åœ¨æˆ–æ— æƒæŸ¥çœ‹&#34;</span>)
		e.Log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;db error: %s&#34;</span>, err)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">if</span> db.Error <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.Log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;db error: %s&#34;</span>, err)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">return</span> <span style="color:#cb4b16">nil</span>
}

<span style="color:#586e75">// InsertApplication åˆ›å»ºApplicationå¯¹è±¡
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">InsertApplication</span>(model common.ActiveRecord) <span style="color:#dc322f">error</span> {
	<span style="color:#268bd2">var</span> err <span style="color:#dc322f">error</span>
	<span style="color:#268bd2">var</span> data cmdb.Application

	err = e.Orm.<span style="color:#268bd2">Model</span>(<span style="color:#719e07">&amp;</span>data).
		<span style="color:#268bd2">Create</span>(model).Error
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.Log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;db error: %s&#34;</span>, err)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">return</span> <span style="color:#cb4b16">nil</span>
}

<span style="color:#586e75">// UpdateApplication ä¿®æ”¹Applicationå¯¹è±¡
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">UpdateApplication</span>(c common.ActiveRecord, p <span style="color:#719e07">*</span>actions.DataPermission) <span style="color:#dc322f">error</span> {
	<span style="color:#268bd2">var</span> err <span style="color:#dc322f">error</span>

	db <span style="color:#719e07">:=</span> e.Orm.<span style="color:#268bd2">Model</span>(c).
		<span style="color:#268bd2">Scopes</span>(
			actions.<span style="color:#268bd2">Permission</span>(c.<span style="color:#268bd2">TableName</span>(), p),
		).<span style="color:#268bd2">Where</span>(c.<span style="color:#268bd2">GetId</span>()).<span style="color:#268bd2">Updates</span>(c)
	<span style="color:#719e07">if</span> db.Error <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.Log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;db error: %s&#34;</span>, err)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">if</span> db.RowsAffected <span style="color:#719e07">==</span> <span style="color:#2aa198">0</span> {
		<span style="color:#719e07">return</span> errors.<span style="color:#268bd2">New</span>(<span style="color:#2aa198">&#34;æ— æƒæ›´æ–°è¯¥æ•°æ®&#34;</span>)

	}
	<span style="color:#719e07">return</span> <span style="color:#cb4b16">nil</span>
}

<span style="color:#586e75">// RemoveApplication åˆ é™¤Application
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">RemoveApplication</span>(d cDto.Control, c common.ActiveRecord, p <span style="color:#719e07">*</span>actions.DataPermission) <span style="color:#dc322f">error</span> {
	<span style="color:#268bd2">var</span> err <span style="color:#dc322f">error</span>
	<span style="color:#268bd2">var</span> data cmdb.Application

	db <span style="color:#719e07">:=</span> e.Orm.<span style="color:#268bd2">Model</span>(<span style="color:#719e07">&amp;</span>data).
		<span style="color:#268bd2">Scopes</span>(
			actions.<span style="color:#268bd2">Permission</span>(data.<span style="color:#268bd2">TableName</span>(), p),
		).<span style="color:#268bd2">Where</span>(d.<span style="color:#268bd2">GetId</span>()).<span style="color:#268bd2">Delete</span>(c)
	<span style="color:#719e07">if</span> db.Error <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		err = db.Error
		e.Log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Delete error: %s&#34;</span>, err)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">if</span> db.RowsAffected <span style="color:#719e07">==</span> <span style="color:#2aa198">0</span> {
		err = errors.<span style="color:#268bd2">New</span>(<span style="color:#2aa198">&#34;æ— æƒåˆ é™¤è¯¥æ•°æ®&#34;</span>)
		<span style="color:#719e07">return</span> err
	}
	<span style="color:#719e07">return</span> <span style="color:#cb4b16">nil</span>
}
</code></pre></div><p>serviceä¸­åŒ…å«äº†å¯¹æ•°æ®çš„ä¸€ä¸ªæ•°æ®æ“ä½œ</p>
<p><strong>apis</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> cmdb

<span style="color:#719e07">import</span> (
	<span style="color:#2aa198">&#34;net/http&#34;</span>

	<span style="color:#2aa198">&#34;github.com/gin-gonic/gin&#34;</span>
	<span style="color:#2aa198">&#34;github.com/go-admin-team/go-admin-core/sdk/pkg/jwtauth/user&#34;</span>

	<span style="color:#2aa198">&#34;oops/internal/app/admin/models/cmdb&#34;</span>
	service <span style="color:#2aa198">&#34;oops/internal/app/admin/service/cmdb&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/app/admin/service/cmdb/dto&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/actions&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/apis&#34;</span>
	common <span style="color:#2aa198">&#34;oops/internal/common/models&#34;</span>
)

<span style="color:#268bd2">type</span> Application <span style="color:#268bd2">struct</span> {
	apis.Api
}

<span style="color:#586e75">// @Summary åˆ—è¡¨åº”ç”¨ä¿¡æ¯æ•°æ®
</span><span style="color:#586e75">// @Description è·å–JSON
</span><span style="color:#586e75">// @Tags åº”ç”¨
</span><span style="color:#586e75">// @Param appName query string false &#34;appName&#34;
</span><span style="color:#586e75">// @Success 200 {string} string &#34;{&#34;code&#34;: 200, &#34;data&#34;: [...]}&#34;
</span><span style="color:#586e75">// @Success 200 {string} string &#34;{&#34;code&#34;: -1, &#34;message&#34;: &#34;æŠ±æ­‰æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯&#34;}&#34;
</span><span style="color:#586e75">// @Router /api/v1/cmdb/application [get]
</span><span style="color:#586e75">// @Security Bearer
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">GetApplicationList</span>(c <span style="color:#719e07">*</span>gin.Context) {
	log <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetLogger</span>(c)
	d <span style="color:#719e07">:=</span> <span style="color:#b58900">new</span>(dto.ApplicationSearch)
	db, err <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetOrm</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}

	req <span style="color:#719e07">:=</span> d.<span style="color:#268bd2">Generate</span>()

	<span style="color:#586e75">//æŸ¥è¯¢åˆ—è¡¨
</span><span style="color:#586e75"></span>	err = req.<span style="color:#268bd2">Bind</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Warnf</span>(<span style="color:#2aa198">&#34;Bind error: %s&#34;</span>, err.<span style="color:#268bd2">Error</span>())
		e.<span style="color:#268bd2">Error</span>(c, http.StatusUnprocessableEntity, err, <span style="color:#2aa198">&#34;å‚æ•°éªŒè¯å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}

	<span style="color:#586e75">//æ•°æ®æƒé™æ£€æŸ¥
</span><span style="color:#586e75"></span>	p <span style="color:#719e07">:=</span> actions.<span style="color:#268bd2">GetPermissionFromContext</span>(c)

	list <span style="color:#719e07">:=</span> <span style="color:#b58900">make</span>([]cmdb.Application, <span style="color:#2aa198">0</span>)
	<span style="color:#268bd2">var</span> count <span style="color:#dc322f">int64</span>
	serviceStudent <span style="color:#719e07">:=</span> service.Application{}
	serviceStudent.Log = log
	serviceStudent.Orm = db
	err = serviceStudent.<span style="color:#268bd2">GetApplicationPage</span>(req, p, <span style="color:#719e07">&amp;</span>list, <span style="color:#719e07">&amp;</span>count)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusInternalServerError, err, <span style="color:#2aa198">&#34;æŸ¥è¯¢å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}

	e.<span style="color:#268bd2">PageOK</span>(c, list, <span style="color:#b58900">int</span>(count), req.<span style="color:#268bd2">GetPageIndex</span>(), req.<span style="color:#268bd2">GetPageSize</span>(), <span style="color:#2aa198">&#34;æŸ¥è¯¢æˆåŠŸ&#34;</span>)
}

<span style="color:#586e75">// @Summary è·å–åº”ç”¨
</span><span style="color:#586e75">// @Description è·å–JSON
</span><span style="color:#586e75">// @Tags åº”ç”¨
</span><span style="color:#586e75">// @Param appId path int true &#34;åº”ç”¨ç¼–ç &#34;
</span><span style="color:#586e75">// @Success 200 {object} app.Response &#34;{&#34;code&#34;: 200, &#34;data&#34;: [...]}&#34;
</span><span style="color:#586e75">// @Router /api/v1/cmdb/application/{appId} [get]
</span><span style="color:#586e75">// @Security Bearer
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">GetApplication</span>(c <span style="color:#719e07">*</span>gin.Context) {
	log <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetLogger</span>(c)
	control <span style="color:#719e07">:=</span> <span style="color:#b58900">new</span>(dto.ApplicationById)
	db, err <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetOrm</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}

	<span style="color:#586e75">//æŸ¥çœ‹è¯¦æƒ…
</span><span style="color:#586e75"></span>	req <span style="color:#719e07">:=</span> control.<span style="color:#268bd2">Generate</span>()
	err = req.<span style="color:#268bd2">Bind</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusUnprocessableEntity, err, <span style="color:#2aa198">&#34;å‚æ•°éªŒè¯å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}
	<span style="color:#268bd2">var</span> object cmdb.Application

	<span style="color:#586e75">//æ•°æ®æƒé™æ£€æŸ¥
</span><span style="color:#586e75"></span>	p <span style="color:#719e07">:=</span> actions.<span style="color:#268bd2">GetPermissionFromContext</span>(c)

	serviceApplication <span style="color:#719e07">:=</span> service.Application{}
	serviceApplication.Log = log
	serviceApplication.Orm = db
	err = serviceApplication.<span style="color:#268bd2">GetApplication</span>(req, p, <span style="color:#719e07">&amp;</span>object)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusUnprocessableEntity, err, <span style="color:#2aa198">&#34;æŸ¥è¯¢å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}

	e.<span style="color:#268bd2">OK</span>(c, object, <span style="color:#2aa198">&#34;æŸ¥çœ‹æˆåŠŸ&#34;</span>)
}

<span style="color:#586e75">// @Summary åˆ›å»ºåº”ç”¨
</span><span style="color:#586e75">// @Description è·å–JSON
</span><span style="color:#586e75">// @Tags åº”ç”¨
</span><span style="color:#586e75">// @Accept  application/json
</span><span style="color:#586e75">// @Product application/json
</span><span style="color:#586e75">// @Param data body models.SysUser true &#34;åº”ç”¨æ•°æ®&#34;
</span><span style="color:#586e75">// @Success 200 {string} string	&#34;{&#34;code&#34;: 200, &#34;message&#34;: &#34;æ·»åŠ æˆåŠŸ&#34;}&#34;
</span><span style="color:#586e75">// @Success 200 {string} string	&#34;{&#34;code&#34;: -1, &#34;message&#34;: &#34;æ·»åŠ å¤±è´¥&#34;}&#34;
</span><span style="color:#586e75">// @Router /api/v1/cmdb/application [post]
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">InsertApplication</span>(c <span style="color:#719e07">*</span>gin.Context) {
	log <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetLogger</span>(c)
	control <span style="color:#719e07">:=</span> <span style="color:#b58900">new</span>(dto.ApplicationControl)
	db, err <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetOrm</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}

	<span style="color:#586e75">//æ–°å¢æ“ä½œ
</span><span style="color:#586e75"></span>	req <span style="color:#719e07">:=</span> control.<span style="color:#268bd2">Generate</span>()
	err = req.<span style="color:#268bd2">Bind</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusUnprocessableEntity, err, <span style="color:#2aa198">&#34;å‚æ•°éªŒè¯å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}
	<span style="color:#268bd2">var</span> object common.ActiveRecord
	object, err = req.<span style="color:#268bd2">GenerateM</span>()
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusInternalServerError, err, <span style="color:#2aa198">&#34;æ¨¡å‹ç”Ÿæˆå¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}
	<span style="color:#586e75">// è®¾ç½®åˆ›å»ºäºº
</span><span style="color:#586e75"></span>	object.<span style="color:#268bd2">SetCreateBy</span>(user.<span style="color:#268bd2">GetUserId</span>(c))

	serviceApplication <span style="color:#719e07">:=</span> service.Application{}
	serviceApplication.Orm = db
	serviceApplication.Log = log
	err = serviceApplication.<span style="color:#268bd2">InsertApplication</span>(object)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		e.<span style="color:#268bd2">Error</span>(c, http.StatusInternalServerError, err, <span style="color:#2aa198">&#34;åˆ›å»ºå¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}

	e.<span style="color:#268bd2">OK</span>(c, object.<span style="color:#268bd2">GetId</span>(), <span style="color:#2aa198">&#34;åˆ›å»ºæˆåŠŸ&#34;</span>)
}

<span style="color:#586e75">// @Summary ä¿®æ”¹åº”ç”¨æ•°æ®
</span><span style="color:#586e75">// @Description è·å–JSON
</span><span style="color:#586e75">// @Tags åº”ç”¨
</span><span style="color:#586e75">// @Accept  application/json
</span><span style="color:#586e75">// @Product application/json
</span><span style="color:#586e75">// @Param data body models.SysUser true &#34;body&#34;
</span><span style="color:#586e75">// @Success 200 {string} string	&#34;{&#34;code&#34;: 200, &#34;message&#34;: &#34;ä¿®æ”¹æˆåŠŸ&#34;}&#34;
</span><span style="color:#586e75">// @Success 200 {string} string	&#34;{&#34;code&#34;: -1, &#34;message&#34;: &#34;ä¿®æ”¹å¤±è´¥&#34;}&#34;
</span><span style="color:#586e75">// @Router /api/v1/cmdb/application/{appId} [put]
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">UpdateApplication</span>(c <span style="color:#719e07">*</span>gin.Context) {
	control <span style="color:#719e07">:=</span> <span style="color:#b58900">new</span>(dto.ApplicationControl)

	log <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetLogger</span>(c)
	db, err <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetOrm</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}

	req <span style="color:#719e07">:=</span> control.<span style="color:#268bd2">Generate</span>()
	<span style="color:#586e75">//æ›´æ–°æ“ä½œ
</span><span style="color:#586e75"></span>	err = req.<span style="color:#268bd2">Bind</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusUnprocessableEntity, err, <span style="color:#2aa198">&#34;å‚æ•°éªŒè¯å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}
	<span style="color:#268bd2">var</span> object common.ActiveRecord
	object, err = req.<span style="color:#268bd2">GenerateM</span>()
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusInternalServerError, err, <span style="color:#2aa198">&#34;æ¨¡å‹ç”Ÿæˆå¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}
	object.<span style="color:#268bd2">SetUpdateBy</span>(user.<span style="color:#268bd2">GetUserId</span>(c))

	<span style="color:#586e75">//æ•°æ®æƒé™æ£€æŸ¥
</span><span style="color:#586e75"></span>	p <span style="color:#719e07">:=</span> actions.<span style="color:#268bd2">GetPermissionFromContext</span>(c)

	serviceApplication <span style="color:#719e07">:=</span> service.Application{}
	serviceApplication.Orm = db
	serviceApplication.Log = log
	err = serviceApplication.<span style="color:#268bd2">UpdateApplication</span>(object, p)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}
	e.<span style="color:#268bd2">OK</span>(c, object.<span style="color:#268bd2">GetId</span>(), <span style="color:#2aa198">&#34;æ›´æ–°æˆåŠŸ&#34;</span>)
}

<span style="color:#586e75">// @Summary åˆ é™¤åº”ç”¨æ•°æ®
</span><span style="color:#586e75">// @Description åˆ é™¤æ•°æ®
</span><span style="color:#586e75">// @Tags åº”ç”¨
</span><span style="color:#586e75">// @Param appId path int true &#34;appId&#34;
</span><span style="color:#586e75">// @Success 200 {string} string	&#34;{&#34;code&#34;: 200, &#34;message&#34;: &#34;åˆ é™¤æˆåŠŸ&#34;}&#34;
</span><span style="color:#586e75">// @Success 200 {string} string	&#34;{&#34;code&#34;: -1, &#34;message&#34;: &#34;åˆ é™¤å¤±è´¥&#34;}&#34;
</span><span style="color:#586e75">// @Router /api/v1/cmdb/application/{appId} [delete]
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> (e <span style="color:#719e07">*</span>Application) <span style="color:#268bd2">DeleteApplication</span>(c <span style="color:#719e07">*</span>gin.Context) {
	log <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetLogger</span>(c)
	control <span style="color:#719e07">:=</span> <span style="color:#b58900">new</span>(dto.ApplicationById)

	db, err <span style="color:#719e07">:=</span> e.<span style="color:#268bd2">GetOrm</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}

	<span style="color:#586e75">//åˆ é™¤æ“ä½œ
</span><span style="color:#586e75"></span>	req <span style="color:#719e07">:=</span> control.<span style="color:#268bd2">Generate</span>()
	err = req.<span style="color:#268bd2">Bind</span>(c)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Bind error: %s&#34;</span>, err)
		e.<span style="color:#268bd2">Error</span>(c, http.StatusUnprocessableEntity, err, <span style="color:#2aa198">&#34;å‚æ•°éªŒè¯å¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}
	<span style="color:#268bd2">var</span> object common.ActiveRecord
	object, err = req.<span style="color:#268bd2">GenerateM</span>()
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		e.<span style="color:#268bd2">Error</span>(c, http.StatusInternalServerError, err, <span style="color:#2aa198">&#34;æ¨¡å‹ç”Ÿæˆå¤±è´¥&#34;</span>)
		<span style="color:#719e07">return</span>
	}

	<span style="color:#586e75">// è®¾ç½®ç¼–è¾‘äºº
</span><span style="color:#586e75"></span>	object.<span style="color:#268bd2">SetUpdateBy</span>(user.<span style="color:#268bd2">GetUserId</span>(c))

	<span style="color:#586e75">// æ•°æ®æƒé™æ£€æŸ¥
</span><span style="color:#586e75"></span>	p <span style="color:#719e07">:=</span> actions.<span style="color:#268bd2">GetPermissionFromContext</span>(c)

	serviceApplication <span style="color:#719e07">:=</span> service.Application{}
	serviceApplication.Orm = db
	serviceApplication.Log = log
	err = serviceApplication.<span style="color:#268bd2">RemoveApplication</span>(req, object, p)
	<span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
		log.<span style="color:#268bd2">Error</span>(err)
		<span style="color:#719e07">return</span>
	}
	e.<span style="color:#268bd2">OK</span>(c, object.<span style="color:#268bd2">GetId</span>(), <span style="color:#2aa198">&#34;åˆ é™¤æˆåŠŸ&#34;</span>)
}

</code></pre></div><p><strong>routes</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> router

<span style="color:#719e07">import</span> (
	<span style="color:#2aa198">&#34;oops/internal/app/admin/apis/cmdb&#34;</span>
	<span style="color:#2aa198">&#34;oops/internal/common/actions&#34;</span>
	middleware2 <span style="color:#2aa198">&#34;oops/internal/common/middleware&#34;</span>

	<span style="color:#2aa198">&#34;github.com/gin-gonic/gin&#34;</span>
	jwt <span style="color:#2aa198">&#34;github.com/go-admin-team/go-admin-core/sdk/pkg/jwtauth&#34;</span>
)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">init</span>() {
	routerCheckRole = <span style="color:#b58900">append</span>(routerCheckRole, registerApplicationRouter)
}

<span style="color:#586e75">// éœ€è®¤è¯çš„è·¯ç”±ä»£ç 
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">registerApplicationRouter</span>(v1 <span style="color:#719e07">*</span>gin.RouterGroup, authMiddleware <span style="color:#719e07">*</span>jwt.GinJWTMiddleware) {
	api <span style="color:#719e07">:=</span> <span style="color:#719e07">&amp;</span>cmdb.Application{}
	r <span style="color:#719e07">:=</span> v1.<span style="color:#268bd2">Group</span>(<span style="color:#2aa198">&#34;/cmdb/application&#34;</span>).<span style="color:#268bd2">Use</span>(authMiddleware.<span style="color:#268bd2">MiddlewareFunc</span>()).<span style="color:#268bd2">Use</span>(middleware2.<span style="color:#268bd2">AuthCheckRole</span>()).<span style="color:#268bd2">Use</span>(actions.<span style="color:#268bd2">PermissionAction</span>())
	{
		r.<span style="color:#268bd2">GET</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.GetApplicationList)
		r.<span style="color:#268bd2">GET</span>(<span style="color:#2aa198">&#34;/:id&#34;</span>, api.GetApplication)
		r.<span style="color:#268bd2">POST</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.InsertApplication)
		r.<span style="color:#268bd2">PUT</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.UpdateApplication)
		r.<span style="color:#268bd2">DELETE</span>(<span style="color:#2aa198">&#34;&#34;</span>, api.DeleteApplication)
	}
}
</code></pre></div><p>åˆ›å»ºä¸€ä¸ªç©ºçš„goæ–‡ä»¶ï¼Œè®¾ç½®initåˆå§‹åŒ–æ¥å£æ–¹æ³•ï¼Œæ ¹æ®ä¸šåŠ¡å®šä¹‰å¥½è·¯ç”±æ³¨å†Œå‡½æ•°åç§°ï¼Œå¹¶ä¸”æ­£ç¡®é…ç½®æ­£ç¡®çš„æƒé™æ§åˆ¶ä¸­é—´ä»¶ï¼Œä¸€å¥—ä¸šåŠ¡å°±ç»“æŸäº†;</p>
<hr>
<h2 id="4-æ€»ç»“">
  4. æ€»ç»“
  <a class="heading-link" href="#4-%e6%80%bb%e7%bb%93">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>æœ¬ç« è¯´æ˜äº†oopsé¡¹ç›®çš„åç«¯ä»£ç ç»“æ„ï¼Œä»¥åŠå®ç°ä¸€ä¸ªä¸šåŠ¡çš„é€»è¾‘æ“ä½œã€‚æ•´ä¸ªé¡¹ç›®ä¼šç”¨åˆ°çš„ä¸»æµæ¡†æ¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>go-admin</li>
<li>cobra</li>
<li>gorm</li>
<li>gin</li>
<li>casbin</li>
<li>swagger</li>
<li>viper(åç»­è€ƒè™‘åŠ å…¥)</li>
</ul>
<hr>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    Â©
    
      2019 -
    
    2021
     Hello.CC 
    Â·
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">CCoder</a>.
    
  </section>
</footer>

    </main>

    
      
      <script src="/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js" integrity="sha256-A7F3afT5GuNWZ&#43;HyocqMFvUFYlds&#43;Q/zKzF5kmkU2qU="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
