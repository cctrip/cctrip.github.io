<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Kubernetesç³»åˆ—ï¼šç½‘ç»œ - CC&#39;s Trip</title><meta name="Description" content="ç½‘ç»œ"><meta property="og:title" content="Kubernetesç³»åˆ—ï¼šç½‘ç»œ" />
<meta property="og:description" content="ç½‘ç»œ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cctrip.github.io/k8s_series_network/" /><meta property="og:image" content="https://cctrip.github.io/k8s_series_network/k8s-image.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-30T17:55:28&#43;08:00" />
<meta property="article:modified_time" content="2020-10-30T17:55:28&#43;08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cctrip.github.io/k8s_series_network/k8s-image.jpg"/>
<meta name="twitter:title" content="Kubernetesç³»åˆ—ï¼šç½‘ç»œ"/>
<meta name="twitter:description" content="ç½‘ç»œ"/>
<meta name="application-name" content="CC&#39;s Trip">
<meta name="apple-mobile-web-app-title" content="CC&#39;s Trip"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/leo.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://cctrip.github.io/k8s_series_network/" /><link rel="prev" href="https://cctrip.github.io/k8s_series_container/" /><link rel="next" href="https://cctrip.github.io/k8s_series_storage/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Kubernetesç³»åˆ—ï¼šç½‘ç»œ",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/cctrip.github.io\/k8s_series_network\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/cctrip.github.io\/k8s_series_network\/k8s-image.jpg",
                            "width":  1200 ,
                            "height":  628 
                        }],"genre": "posts","keywords": "kubernetes","wordcount":  5279 ,
        "url": "https:\/\/cctrip.github.io\/k8s_series_network\/","datePublished": "2020-10-30T17:55:28+08:00","dateModified": "2020-10-30T17:55:28+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/cctrip.github.io\/images\/cc.jpg",
                    "width":  250 ,
                    "height":  250 
                }},"author": {
                "@type": "Person",
                "name": "Hello.CC"
            },"description": "ç½‘ç»œ"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="CC&#39;s Trip">CC&#39;s Trip</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/notes"> Notes </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/resume/" title="Resume"><i class='fas fa-user-tie'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="CC&#39;s Trip">CC&#39;s Trip</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/notes" title="">Notes</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/resume/" title="Resume"><i class='fas fa-user-tie'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Kubernetesç³»åˆ—ï¼šç½‘ç»œ</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://cctrip.org" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Hello.CC</a></span>&nbsp;<span class="post-category">included in <a href="/categories/cloud-native/"><i class="far fa-folder fa-fw"></i>Cloud Native</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-10-30">2020-10-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;5279 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;11 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/k8s_series_network/k8s-image.jpg"
        data-srcset="/k8s_series_network/k8s-image.jpg, /k8s_series_network/k8s-image.jpg 1.5x, /k8s_series_network/k8s-image.jpg 2x"
        data-sizes="auto"
        alt="/k8s_series_network/k8s-image.jpg"
        title="ç½‘ç»œ" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#ç³»åˆ—ç›®å½•">ç³»åˆ—ç›®å½•</a></li>
    <li><a href="#1-ä»‹ç»">1. ä»‹ç»</a></li>
    <li><a href="#2-åŸºæœ¬åŸç†">2. åŸºæœ¬åŸç†</a>
      <ul>
        <li><a href="#21-container-to-container">2.1 Container-to-Container</a></li>
        <li><a href="#22-pod-to-pod">2.2 Pod-to-Pod</a>
          <ul>
            <li><a href="#221-åŒnode">2.2.1 åŒNode</a></li>
            <li><a href="#222-è·¨node">2.2.2 è·¨Node</a></li>
          </ul>
        </li>
        <li><a href="#23-pod-to-service-å’Œ-internet-to-service">2.3 Pod-to-Service å’Œ Internet-to-Service</a></li>
      </ul>
    </li>
    <li><a href="#3-cni">3. CNI</a>
      <ul>
        <li><a href="#31-æ¥å£å®šä¹‰">3.1 æ¥å£å®šä¹‰</a></li>
        <li><a href="#32-è®¾è®¡è€ƒé‡">3.2 è®¾è®¡è€ƒé‡</a></li>
        <li><a href="#33-cni-æ’ä»¶">3.3 CNI æ’ä»¶</a>
          <ul>
            <li><a href="#331-å‚æ•°">3.3.1 å‚æ•°</a></li>
            <li><a href="#332-ip-åˆ†é…">3.3.2 IP åˆ†é…</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#4-ä¸»æµæ–¹æ¡ˆ">4. ä¸»æµæ–¹æ¡ˆ</a>
      <ul>
        <li><a href="#41-amazon-vpc-cni-k8s">4.1 amazon-vpc-cni-k8s</a>
          <ul>
            <li><a href="#411-k8sè¿è¡Œåœ¨aws-vpcä¸Šçš„ç›®æ ‡">4.1.1 K8Sè¿è¡Œåœ¨AWS VPCä¸Šçš„ç›®æ ‡</a></li>
            <li><a href="#412-æ–¹æ¡ˆ">4.1.2 æ–¹æ¡ˆ</a></li>
            <li><a href="#413-æ¶æ„">4.1.3 æ¶æ„</a></li>
            <li><a href="#414-cniæ’ä»¶æ‰§è¡Œçš„æ“ä½œ">4.1.4 CNIæ’ä»¶æ‰§è¡Œçš„æ“ä½œ</a></li>
            <li><a href="#415-æµé‡è¿‡ç¨‹">4.1.5 æµé‡è¿‡ç¨‹</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#5-ç»“è®º">5. ç»“è®º</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="ç³»åˆ—ç›®å½•">ç³»åˆ—ç›®å½•</h2>
<p><a href="../k8s_series" rel="">ã€ŠKubernetesç³»åˆ—ï¼šå¼€ç¯‡ã€‹</a></p>
<p><a href="../k8s_series_intro" rel="">ã€ŠKubernetesç³»åˆ—ï¼šæ¦‚è¿°ã€‹</a></p>
<p><a href="../k8s_series_arch" rel="">ã€ŠKubernetesç³»åˆ—ï¼šæ¶æ„ã€‹</a></p>
<p><a href="../k8s_series_container" rel="">ã€ŠKubernetesç³»åˆ—ï¼šå®¹å™¨ã€‹</a></p>
<p><a href="../k8s_series_network" rel="">ã€ŠKubernetesç³»åˆ—ï¼šç½‘ç»œã€‹</a></p>
<p><a href="../k8s_series_storage" rel="">ã€ŠKubernetesç³»åˆ—ï¼šå­˜å‚¨ã€‹</a></p>
<p><a href="../k8s_series_service" rel="">ã€ŠKubernetesç³»åˆ—ï¼šServiceã€‹</a></p>
<p><a href="../k8s_series_ingress" rel="">ã€ŠKubernetesç³»åˆ—ï¼šIngressã€‹</a></p>
<p><a href="../k8s_series_oma" rel="">ã€ŠKubernetesç³»åˆ—ï¼šOAMã€‹</a></p>
<hr>
<h2 id="1-ä»‹ç»">1. ä»‹ç»</h2>
<p>ç½‘ç»œæ˜¯ Kubernetes çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸è¿‡ï¼ŒKubernetesæœ¬èº«å¹¶ä¸æä¾›ç½‘ç»œåŠŸèƒ½ï¼Œåªæ˜¯æŠŠç½‘ç»œæ¥å£å¼€æ”¾å‡ºæ¥ï¼Œé€šè¿‡æ’ä»¶çš„å½¢å¼å®ç°ã€‚è¿™å°±æ˜¯CNI(Container Network Interface)ã€‚</p>
<blockquote>
<p>CNIï¼ˆContainer Network Interfaceï¼‰æ˜¯ CNCF æ——ä¸‹çš„ä¸€ä¸ªé¡¹ç›®ï¼Œç”±ä¸€ç»„ç”¨äºé…ç½® Linux å®¹å™¨çš„ç½‘ç»œæ¥å£çš„è§„èŒƒå’Œåº“ç»„æˆï¼ŒåŒæ—¶è¿˜åŒ…å«äº†ä¸€äº›æ’ä»¶ã€‚CNI ä»…å…³å¿ƒå®¹å™¨åˆ›å»ºæ—¶çš„ç½‘ç»œåˆ†é…ï¼Œå’Œå½“å®¹å™¨è¢«åˆ é™¤æ—¶é‡Šæ”¾ç½‘ç»œèµ„æºã€‚é€šè¿‡æ­¤é“¾æ¥æµè§ˆè¯¥é¡¹ç›®ï¼šhttps://github.com/containernetworking/cniã€‚</p>
</blockquote>
<p>Kubernetes å¯¹æ‰€æœ‰ç½‘ç»œè®¾æ–½çš„å®æ–½ï¼Œéƒ½éœ€è¦æ»¡è¶³ä»¥ä¸‹çš„åŸºæœ¬è¦æ±‚ï¼š</p>
<ul>
<li>èŠ‚ç‚¹ä¸Šçš„ Pod å¯ä»¥ä¸é€šè¿‡ NAT å’Œå…¶ä»–ä»»ä½•èŠ‚ç‚¹ä¸Šçš„ Pod é€šä¿¡</li>
<li>èŠ‚ç‚¹ä¸Šçš„ä»£ç†(æ¯”å¦‚ï¼šç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ã€kubelet)å¯ä»¥å’ŒèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰Podé€šä¿¡</li>
<li>Podè‡ªå·±çš„IPå°±æ˜¯å…¶ä»–äººçœ‹åˆ°çš„IP</li>
</ul>
<p>å› æ­¤ï¼Œä¸€ä¸ªkubernetesç½‘ç»œæ’ä»¶å¿…é¡»è¦è§£å†³ä¸‹é¢äº”ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>Container-to-Container ç½‘ç»œé€šä¿¡</li>
<li>Pod-to-Pod ç½‘ç»œé€šä¿¡</li>
<li>Pod-to-Service ç½‘ç»œé€šä¿¡</li>
<li>Internet-to-Service ç½‘ç»œé€šä¿¡</li>
<li>Pod IPåœ¨é›†ç¾¤å†…å”¯ä¸€</li>
</ol>
<hr>
<h2 id="2-åŸºæœ¬åŸç†">2. åŸºæœ¬åŸç†</h2>
<h3 id="21-container-to-container">2.1 Container-to-Container</h3>
<p>åœ¨kubernetesä¸­ï¼Œä¸€ä¸ªPodæ˜¯ä¸€ç»„Containerçš„ç»„åˆï¼Œå¹¶ä¸”ï¼ŒPodå†…çš„Containeræ˜¯å…±äº«network namespaceçš„ï¼Œå› æ­¤è¯¥Podå†…çš„Containerçš„ipå’Œmacåœ°å€éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å®ƒä»¬åªéœ€è¦é€šè¿‡localhostå°±èƒ½è·ŸPodå†…å…¶ä»–Containeré€šä¿¡äº†ï¼Œä¸è¿‡ï¼Œå› ä¸ºæ˜¯å…±äº«network namespaceï¼Œå› æ­¤è¯¥Podå†…çš„ç«¯å£å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½å†²çªã€‚</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="c-to-c.png"
        data-srcset="/k8s_series_network/c-to-c.png, c-to-c.png 1.5x, /k8s_series_network/c-to-c.png 2x"
        data-sizes="auto"
        alt="/k8s_series_network/c-to-c.png"
        title="/k8s_series_network/c-to-c.png" /></p>
<hr>
<h3 id="22-pod-to-pod">2.2 Pod-to-Pod</h3>
<p>åœ¨å®¹å™¨ä¸­ï¼Œå®¹å™¨å¯ä»¥é€šè¿‡network namespaceçš„æŠ€æœ¯å°†ä¸åŒçš„å®¹å™¨çš„ç½‘ç»œéš”ç¦»èµ·æ¥ï¼Œå¹¶é€šè¿‡veth pairæŠ€æœ¯å°†ä¸¤ä¸ªnamespaceè¿æ¥èµ·æ¥ä»¥è¿›è¡Œé€šä¿¡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªpodéƒ½æœ‰è‡ªå·±çš„netnsï¼Œé€šè¿‡veth pairè·ŸèŠ‚ç‚¹çš„root netnsè¿æ¥èµ·æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œpodå°±èƒ½ç›´æ¥è·Ÿnodeè¿›è¡Œé€šä¿¡äº†</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="pod-veth-pairs.png"
        data-srcset="/k8s_series_network/pod-veth-pairs.png, pod-veth-pairs.png 1.5x, /k8s_series_network/pod-veth-pairs.png 2x"
        data-sizes="auto"
        alt="/k8s_series_network/pod-veth-pairs.png"
        title="/k8s_series_network/pod-veth-pairs.png" /></p>
<p>ä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬åˆå¸Œæœ›pod1è·Ÿpod2è¿›è¡Œé€šä¿¡ï¼Œå› æ­¤ï¼Œåˆéœ€è¦æ·»åŠ é¢å¤–çš„æŠ€æœ¯å…è®¸æ•°æ®åŒ…é€šè¿‡root netnsä¼ å…¥ä¸åŒçš„podçš„netnsä¸­ï¼Œæ¯”å¦‚bridgeæŠ€æœ¯ï¼Œå½“ç„¶ï¼Œä¹Ÿæœ‰äº›å¯ä»¥ç”¨è·¯ç”±è¡¨æ¥å®ç°ã€‚</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="pods-connected-by-bridge.png"
        data-srcset="/k8s_series_network/pods-connected-by-bridge.png, pods-connected-by-bridge.png 1.5x, /k8s_series_network/pods-connected-by-bridge.png 2x"
        data-sizes="auto"
        alt="/k8s_series_network/pods-connected-by-bridge.png"
        title="/k8s_series_network/pods-connected-by-bridge.png" /></p>
<h4 id="221-åŒnode">2.2.1 åŒNode</h4>
<p>é€šè¿‡network namespaceã€veth pairå’ŒbridgeæŠ€æœ¯ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°åŒnodeå†…çš„podä¹‹é—´çš„é€šä¿¡äº†ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªæ•°æ®åŒ…åœ¨ä¸åŒpodä¹‹é—´çš„æµç¨‹å›¾ï¼š</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="pod-to-pod-same-node.gif"
        data-srcset="/k8s_series_network/pod-to-pod-same-node.gif, pod-to-pod-same-node.gif 1.5x, /k8s_series_network/pod-to-pod-same-node.gif 2x"
        data-sizes="auto"
        alt="/k8s_series_network/pod-to-pod-same-node.gif"
        title="/k8s_series_network/pod-to-pod-same-node.gif" /></p>
<ul>
<li>pod1å°†æ•°æ®åŒ…é€šè¿‡è‡ªå·±çš„eth0è®¾å¤‡å‘é€åˆ°root namespaceçš„veth0ä¸Š</li>
<li>veth0å°†æ•°æ®åŒ…è½¬å‘ç»™cbr0 ç½‘æ¡¥è®¾å¤‡</li>
<li>ç½‘æ¡¥è®¾å¤‡è§£ææ­£ç¡®çš„ç½‘æ®µï¼Œä½¿ç”¨ARPåè®®å°†æ•°æ®åŒ…å‘é€åˆ°veth1</li>
<li>veth1å°†æ•°æ®åŒ…è½¬å‘ç»™pod2çš„namespaceä¸­çš„eth0è®¾å¤‡ä¸Šï¼Œè¿”å›ä¹Ÿæ˜¯ä¸€æ ·çš„æ“ä½œ</li>
</ul>
<h4 id="222-è·¨node">2.2.2 è·¨Node</h4>
<p>é€šå¸¸ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªNodeéƒ½åˆ†é…æœ‰ä¸€ä¸ªCIDRå—ï¼Œè¯¥CIRDå—æŒ‡å®šäº†è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œçš„Podå¯ç”¨çš„IPåœ°å€ã€‚ä¸€æ—¦å‘å¾€CIDRå—çš„æµé‡åˆ°è¾¾Nodeï¼Œåˆ™Nodeæœ‰è´£ä»»å°†æµé‡è½¬å‘åˆ°æ­£ç¡®çš„Podä¸Šã€‚åœ¨è·¨Nodeçš„Podä¸Šï¼Œè¿™é‡Œå°±éœ€è¦CNIæ’ä»¶å…·æœ‰çŸ¥é“æ¯ä¸ªPodçš„ipåœ¨å“ªä¸ªnodeä¸Šçš„åŠŸèƒ½ï¼Œå¹¶ä¸”æœ‰èƒ½åŠ›å°†æ•°æ®åŒ…è·¯ç”±åˆ°æ­£ç¡®çš„Nodeä¸Šã€‚</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="pod-to-pod-different-nodes.gif"
        data-srcset="/k8s_series_network/pod-to-pod-different-nodes.gif, pod-to-pod-different-nodes.gif 1.5x, /k8s_series_network/pod-to-pod-different-nodes.gif 2x"
        data-sizes="auto"
        alt="/k8s_series_network/pod-to-pod-different-nodes.gif"
        title="/k8s_series_network/pod-to-pod-different-nodes.gif" /></p>
<ul>
<li>Pod1å°†æ•°æ®åŒ…å‘å¾€eth0ï¼Œé€šè¿‡veth0åˆ°è¾¾äº†root namespace</li>
<li>Node(VM1)é€šè¿‡è·¯ç”±è¡¨ä¿¡æ¯å°†æ•°æ®åŒ…å‘å¾€ç½‘ç»œä¸­</li>
<li>CNIæ’ä»¶çŸ¥é“ç›®æ ‡ipåœ¨å“ªä¸ªNodeä¸Šï¼Œå°†æ•°æ®åŒ…å‘é€ç»™å¯¹åº”çš„Node(VM2)</li>
<li>VM2æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œå‘ç°ç›®æ ‡ipåœ¨pod4ä¸Šï¼Œé€šè¿‡veth1å°†æ•°æ®åŒ…å‘é€åˆ°pod4çš„eth0ä¸Š</li>
</ul>
<p>åœ¨åç»­çš„ä¸åŒCNIæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šäº†è§£ä¸€ä¸‹å„ä¸ªæ’ä»¶é’ˆå¯¹è·¨Nodeçš„ç½‘ç»œé€šä¿¡çš„å®ç°æœºåˆ¶ã€‚</p>
<hr>
<h3 id="23-pod-to-service-å’Œ-internet-to-service">2.3 Pod-to-Service å’Œ Internet-to-Service</h3>
<p>è¿™ä¸ªç½‘ç»œé€šä¿¡å°†åœ¨Serviceç« èŠ‚ä¸­ç»†è¯´ã€‚</p>
<hr>
<h2 id="3-cni">3. CNI</h2>
<h3 id="31-æ¥å£å®šä¹‰">3.1 æ¥å£å®šä¹‰</h3>
<p>CNI çš„æ¥å£ä¸­åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">CNI</span> <span class="kd">interface</span> <span class="p">{</span><span class="nf">AddNetworkList</span> <span class="p">(</span><span class="nx">net</span> <span class="o">*</span><span class="nx">NetworkConfigList</span><span class="p">,</span> <span class="nx">rt</span> <span class="o">*</span><span class="nx">RuntimeConf</span><span class="p">)</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    <span class="nf">DelNetworkList</span> <span class="p">(</span><span class="nx">net</span> <span class="o">*</span><span class="nx">NetworkConfigList</span><span class="p">,</span> <span class="nx">rt</span> <span class="o">*</span><span class="nx">RuntimeConf</span><span class="p">)</span> <span class="kt">error</span>

    <span class="nf">AddNetwork</span> <span class="p">(</span><span class="nx">net</span> <span class="o">*</span><span class="nx">NetworkConfig</span><span class="p">,</span> <span class="nx">rt</span> <span class="o">*</span><span class="nx">RuntimeConf</span><span class="p">)</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    <span class="nf">DelNetwork</span> <span class="p">(</span><span class="nx">net</span> <span class="o">*</span><span class="nx">NetworkConfig</span><span class="p">,</span> <span class="nx">rt</span> <span class="o">*</span><span class="nx">RuntimeConf</span><span class="p">)</span> <span class="kt">error</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¯¥æ¥å£åªæœ‰å››ä¸ªæ–¹æ³•ï¼Œæ·»åŠ ç½‘ç»œã€åˆ é™¤ç½‘ç»œã€æ·»åŠ ç½‘ç»œåˆ—è¡¨ã€åˆ é™¤ç½‘ç»œåˆ—è¡¨ã€‚</p>
<h3 id="32-è®¾è®¡è€ƒé‡">3.2 è®¾è®¡è€ƒé‡</h3>
<p>CNI è®¾è®¡çš„æ—¶å€™è€ƒè™‘äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>å®¹å™¨è¿è¡Œæ—¶å¿…é¡»åœ¨è°ƒç”¨ä»»ä½•æ’ä»¶ä¹‹å‰ä¸ºå®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œå‘½åç©ºé—´ã€‚</li>
<li>ç„¶åï¼Œè¿è¡Œæ—¶å¿…é¡»ç¡®å®šè¿™ä¸ªå®¹å™¨åº”å±äºå“ªä¸ªç½‘ç»œï¼Œå¹¶ä¸ºæ¯ä¸ªç½‘ç»œç¡®å®šå“ªäº›æ’ä»¶å¿…é¡»è¢«æ‰§è¡Œã€‚</li>
<li>ç½‘ç»œé…ç½®é‡‡ç”¨ JSON æ ¼å¼ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ã€‚ç½‘ç»œé…ç½®åŒ…æ‹¬å¿…å¡«å­—æ®µï¼Œå¦‚ <code>name</code> å’Œ <code>type</code> ä»¥åŠæ’ä»¶ï¼ˆç±»å‹ï¼‰ã€‚ç½‘ç»œé…ç½®å…è®¸å­—æ®µåœ¨è°ƒç”¨ä¹‹é—´æ”¹å˜å€¼ã€‚ä¸ºæ­¤ï¼Œæœ‰ä¸€ä¸ªå¯é€‰çš„å­—æ®µ <code>args</code>ï¼Œå¿…é¡»åŒ…å«ä¸åŒçš„ä¿¡æ¯ã€‚</li>
<li>å®¹å™¨è¿è¡Œæ—¶å¿…é¡»æŒ‰é¡ºåºä¸ºæ¯ä¸ªç½‘ç»œæ‰§è¡Œç›¸åº”çš„æ’ä»¶ï¼Œå°†å®¹å™¨æ·»åŠ åˆ°æ¯ä¸ªç½‘ç»œä¸­ã€‚</li>
<li>åœ¨å®Œæˆå®¹å™¨ç”Ÿå‘½å‘¨æœŸåï¼Œè¿è¡Œæ—¶å¿…é¡»ä»¥ç›¸åçš„é¡ºåºæ‰§è¡Œæ’ä»¶ï¼ˆç›¸å¯¹äºæ‰§è¡Œæ·»åŠ å®¹å™¨çš„é¡ºåºï¼‰ä»¥å°†å®¹å™¨ä¸ç½‘ç»œæ–­å¼€è¿æ¥ã€‚</li>
<li>å®¹å™¨è¿è¡Œæ—¶ä¸èƒ½ä¸ºåŒä¸€å®¹å™¨è°ƒç”¨å¹¶è¡Œæ“ä½œï¼Œä½†å¯ä»¥ä¸ºä¸åŒçš„å®¹å™¨è°ƒç”¨å¹¶è¡Œæ“ä½œã€‚</li>
<li>å®¹å™¨è¿è¡Œæ—¶å¿…é¡»ä¸ºå®¹å™¨è®¢é˜… ADD å’Œ DEL æ“ä½œï¼Œè¿™æ · ADD åé¢æ€»æ˜¯è·Ÿç€ç›¸åº”çš„ DELã€‚ DEL å¯èƒ½è·Ÿç€é¢å¤–çš„ DELï¼Œä½†æ˜¯ï¼Œæ’ä»¶åº”è¯¥å…è®¸å¤„ç†å¤šä¸ª DELï¼ˆå³æ’ä»¶ DEL åº”è¯¥æ˜¯å¹‚ç­‰çš„ï¼‰ã€‚</li>
<li>å®¹å™¨å¿…é¡»ç”± ContainerID å”¯ä¸€æ ‡è¯†ã€‚å­˜å‚¨çŠ¶æ€çš„æ’ä»¶åº”è¯¥ä½¿ç”¨ï¼ˆç½‘ç»œåç§°ï¼Œå®¹å™¨ IDï¼‰çš„ä¸»é”®æ¥å®Œæˆã€‚</li>
<li>è¿è¡Œæ—¶ä¸èƒ½è°ƒç”¨åŒä¸€ä¸ªç½‘ç»œåç§°æˆ–å®¹å™¨ ID æ‰§è¡Œä¸¤æ¬¡ ADDï¼ˆæ²¡æœ‰ç›¸åº”çš„ DELï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œç»™å®šçš„å®¹å™¨ ID å¿…é¡»åªèƒ½æ·»åŠ åˆ°ç‰¹å®šçš„ç½‘ç»œä¸€æ¬¡ã€‚</li>
</ul>
<h3 id="33-cni-æ’ä»¶">3.3 CNI æ’ä»¶</h3>
<p>CNI æ’ä»¶å¿…é¡»å®ç°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥è¢«å®¹å™¨ç®¡ç†ç³»ç»Ÿï¼ˆä¾‹å¦‚ rkt æˆ– Kubernetesï¼‰è°ƒç”¨ã€‚</p>
<p>CNI æ’ä»¶è´Ÿè´£å°†ç½‘ç»œæ¥å£æ’å…¥å®¹å™¨ç½‘ç»œå‘½åç©ºé—´ï¼ˆä¾‹å¦‚ï¼Œveth å¯¹çš„ä¸€ç«¯ï¼‰ï¼Œå¹¶åœ¨ä¸»æœºä¸Šè¿›è¡Œä»»ä½•å¿…è¦çš„æ”¹å˜ï¼ˆä¾‹å¦‚å°† veth çš„å¦ä¸€ç«¯è¿æ¥åˆ°ç½‘æ¡¥ï¼‰ã€‚ç„¶åå°† IP åˆ†é…ç»™æ¥å£ï¼Œå¹¶é€šè¿‡è°ƒç”¨é€‚å½“çš„ IPAM æ’ä»¶æ¥è®¾ç½®ä¸ â€œIP åœ°å€ç®¡ç†â€ éƒ¨åˆ†ä¸€è‡´çš„è·¯ç”±ã€‚</p>
<h4 id="331-å‚æ•°">3.3.1 å‚æ•°</h4>
<p>CNI æ’ä»¶å¿…é¡»æ”¯æŒä»¥ä¸‹æ“ä½œï¼š</p>
<p><strong>å°†å®¹å™¨æ·»åŠ åˆ°ç½‘ç»œ</strong></p>
<p>å‚æ•°ï¼š</p>
<ul>
<li><strong>ç‰ˆæœ¬</strong>è°ƒç”¨è€…æ­£åœ¨ä½¿ç”¨çš„ CNI è§„èŒƒï¼ˆå®¹å™¨ç®¡ç†ç³»ç»Ÿæˆ–è°ƒç”¨æ’ä»¶ï¼‰çš„ç‰ˆæœ¬ã€‚</li>
<li><strong>å®¹å™¨ ID</strong>ç”±è¿è¡Œæ—¶åˆ†é…çš„å®¹å™¨çš„å”¯ä¸€æ˜æ–‡æ ‡è¯†ç¬¦ã€‚ä¸€å®šä¸èƒ½æ˜¯ç©ºçš„ã€‚</li>
<li><strong>ç½‘ç»œå‘½åç©ºé—´è·¯å¾„</strong>è¦æ·»åŠ çš„ç½‘ç»œåç§°ç©ºé—´çš„è·¯å¾„ï¼Œå³ <code>/proc/[pid]/ns/net</code> æˆ–ç»‘å®šæŒ‚è½½ / é“¾æ¥ã€‚</li>
<li><strong>ç½‘ç»œé…ç½®</strong>æè¿°å®¹å™¨å¯ä»¥åŠ å…¥çš„ç½‘ç»œçš„ JSON æ–‡æ¡£ã€‚æ¶æ„å¦‚ä¸‹æ‰€è¿°ã€‚</li>
<li><strong>é¢å¤–çš„å‚æ•°</strong>è¿™æä¾›äº†ä¸€ä¸ªæ›¿ä»£æœºåˆ¶ï¼Œå…è®¸åœ¨æ¯ä¸ªå®¹å™¨ä¸Šç®€å•é…ç½® CNI æ’ä»¶ã€‚</li>
<li><strong>å®¹å™¨å†…æ¥å£çš„åç§°</strong>è¿™æ˜¯åº”è¯¥åˆ†é…ç»™å®¹å™¨ï¼ˆç½‘ç»œå‘½åç©ºé—´ï¼‰å†…åˆ›å»ºçš„æ¥å£çš„åç§°ï¼›å› æ­¤å®ƒå¿…é¡»ç¬¦åˆ Linux æ¥å£åç§°ä¸Šçš„æ ‡å‡†é™åˆ¶ã€‚</li>
</ul>
<p>ç»“æœï¼š</p>
<ul>
<li><strong>æ¥å£åˆ—è¡¨</strong>æ ¹æ®æ’ä»¶çš„ä¸åŒï¼Œè¿™å¯ä»¥åŒ…æ‹¬æ²™ç®±ï¼ˆä¾‹å¦‚å®¹å™¨æˆ–ç®¡ç†ç¨‹åºï¼‰æ¥å£åç§°å’Œ / æˆ–ä¸»æœºæ¥å£åç§°ï¼Œæ¯ä¸ªæ¥å£çš„ç¡¬ä»¶åœ°å€ä»¥åŠæ¥å£æ‰€åœ¨çš„æ²™ç®±ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰çš„è¯¦ç»†ä¿¡æ¯ã€‚</li>
<li><strong>åˆ†é…ç»™æ¯ä¸ªæ¥å£çš„ IP é…ç½®</strong>åˆ†é…ç»™æ²™ç®±å’Œ / æˆ–ä¸»æœºæ¥å£çš„ IPv4 å’Œ / æˆ– IPv6 åœ°å€ï¼Œç½‘å…³å’Œè·¯ç”±ã€‚</li>
<li><strong>DNS ä¿¡æ¯</strong>åŒ…å« nameserverã€domainã€search domain å’Œ option çš„ DNS ä¿¡æ¯çš„å­—å…¸ã€‚</li>
</ul>
<p><strong>ä»ç½‘ç»œä¸­åˆ é™¤å®¹å™¨</strong></p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>
<p><strong>ç‰ˆæœ¬</strong>è°ƒç”¨è€…æ­£åœ¨ä½¿ç”¨çš„ CNI è§„èŒƒï¼ˆå®¹å™¨ç®¡ç†ç³»ç»Ÿæˆ–è°ƒç”¨æ’ä»¶ï¼‰çš„ç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p><strong>å®¹å™¨ ID</strong>ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</p>
</li>
<li>
<p><strong>ç½‘ç»œå‘½åç©ºé—´è·¯å¾„</strong>ï¼Œå¦‚ä¸Šå®šä¹‰ã€‚</p>
</li>
<li>
<p><strong>ç½‘ç»œé…ç½®</strong>ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</p>
</li>
<li>
<p><strong>é¢å¤–çš„å‚æ•°</strong>ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</p>
</li>
<li>
<p><strong>ä¸Šé¢å®šä¹‰çš„å®¹å™¨</strong>å†…çš„æ¥å£çš„åç§°ã€‚</p>
</li>
<li>
<p>æ‰€æœ‰å‚æ•°åº”ä¸ä¼ é€’ç»™ç›¸åº”çš„æ·»åŠ æ“ä½œçš„å‚æ•°ç›¸åŒã€‚</p>
</li>
<li>
<p>åˆ é™¤æ“ä½œåº”é‡Šæ”¾é…ç½®çš„ç½‘ç»œä¸­æä¾›çš„ containerid æ‹¥æœ‰çš„æ‰€æœ‰èµ„æºã€‚</p>
</li>
</ul>
<p>æŠ¥å‘Šç‰ˆæœ¬</p>
<ul>
<li>å‚æ•°ï¼šæ— ã€‚</li>
<li>ç»“æœï¼šæ’ä»¶æ”¯æŒçš„ CNI è§„èŒƒç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="err">â€œcniVersionâ€ï¼šâ€œ0.3.1â€ï¼Œ//</span> <span class="err">æ­¤è¾“å‡ºä½¿ç”¨çš„</span> <span class="err">CNI</span> <span class="err">è§„èŒƒçš„ç‰ˆæœ¬</span>
<span class="err">â€œsupportedVersionsâ€ï¼š[â€œ0.1.0â€ï¼Œâ€œ0.2.0â€ï¼Œâ€œ0.3.0â€ï¼Œâ€œ0.3.1â€]</span> <span class="err">//</span> <span class="err">æ­¤æ’ä»¶æ”¯æŒçš„</span> <span class="err">CNI</span> <span class="err">è§„èŒƒç‰ˆæœ¬åˆ—è¡¨</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>CNI æ’ä»¶çš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š<a href="https://github.com/containernetworking/cni/blob/master/SPEC.md" target="_blank" rel="noopener noreffer">CNI SPEC</a>ã€‚</p>
<h4 id="332-ip-åˆ†é…">3.3.2 IP åˆ†é…</h4>
<p>ä½œä¸ºå®¹å™¨ç½‘ç»œç®¡ç†çš„ä¸€éƒ¨åˆ†ï¼ŒCNI æ’ä»¶éœ€è¦ä¸ºæ¥å£åˆ†é…ï¼ˆå¹¶ç»´æŠ¤ï¼‰IP åœ°å€ï¼Œå¹¶å®‰è£…ä¸è¯¥æ¥å£ç›¸å…³çš„æ‰€æœ‰å¿…è¦è·¯ç”±ã€‚è¿™ç»™äº† CNI æ’ä»¶å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿç»™å®ƒå¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ã€‚ä¼—å¤šçš„ CNI æ’ä»¶éœ€è¦ç¼–å†™ç›¸åŒçš„ä»£ç æ¥æ”¯æŒç”¨æˆ·éœ€è¦çš„å¤šç§ IP ç®¡ç†æ–¹æ¡ˆï¼ˆä¾‹å¦‚ dhcpã€host-localï¼‰ã€‚</p>
<p>ä¸ºäº†å‡è½»è´Ÿæ‹…ï¼Œä½¿ IP ç®¡ç†ç­–ç•¥ä¸ CNI æ’ä»¶ç±»å‹è§£è€¦ï¼Œæˆ‘ä»¬å®šä¹‰äº† IP åœ°å€ç®¡ç†æ’ä»¶ï¼ˆIPAM æ’ä»¶ï¼‰ã€‚CNI æ’ä»¶çš„èŒè´£æ˜¯åœ¨æ‰§è¡Œæ—¶æ°å½“åœ°è°ƒç”¨ IPAM æ’ä»¶ã€‚ IPAM æ’ä»¶å¿…é¡»ç¡®å®šæ¥å£ IP/subnetï¼Œç½‘å…³å’Œè·¯ç”±ï¼Œå¹¶å°†æ­¤ä¿¡æ¯è¿”å›åˆ° â€œä¸»â€ æ’ä»¶æ¥åº”ç”¨é…ç½®ã€‚ IPAM æ’ä»¶å¯ä»¥é€šè¿‡åè®®ï¼ˆä¾‹å¦‚ dhcpï¼‰ã€å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ•°æ®ã€ç½‘ç»œé…ç½®æ–‡ä»¶çš„ â€œipamâ€ éƒ¨åˆ†æˆ–ä¸Šè¿°çš„ç»„åˆæ¥è·å¾—ä¿¡æ¯ã€‚</p>
<hr>
<h2 id="4-ä¸»æµæ–¹æ¡ˆ">4. ä¸»æµæ–¹æ¡ˆ</h2>
<ul>
<li>flannel</li>
<li>calico</li>
<li>cilium</li>
<li>äº‘å‚å•†(VPC)</li>
</ul>
<p>å› ä¸ºæˆ‘è‡ªå·±æ¥è§¦çš„æ˜¯é€šè¿‡åŸºäºAWSçš„EKSå®ç°çš„kubernetesé›†ç¾¤ï¼Œå› æ­¤å…ˆè¯´ä¸‹awsçš„CNIæ’ä»¶æ–¹æ¡ˆ</p>
<hr>
<h3 id="41-amazon-vpc-cni-k8s">4.1 amazon-vpc-cni-k8s</h3>
<h4 id="411-k8sè¿è¡Œåœ¨aws-vpcä¸Šçš„ç›®æ ‡">4.1.1 K8Sè¿è¡Œåœ¨AWS VPCä¸Šçš„ç›®æ ‡</h4>
<ul>
<li>Podè”ç½‘å¿…é¡»æ”¯æŒä¸ç”¨æˆ·ä»EC2è”ç½‘ä¸­è·å¾—çš„ç‰¹æ€§ç›¸å½“çš„é«˜ååé‡å’Œå¯ç”¨æ€§ï¼Œä½å»¶è¿Ÿå’Œæœ€å°æŠ–åŠ¨</li>
<li>å¯ä»¥ä½¿ç”¨è·ŸEC2ä¸€æ ·çš„ç½‘ç»œå®‰å…¨ç»„</li>
<li>ç½‘ç»œæ“ä½œå¿…é¡»ç®€å•å®‰å…¨ã€‚ç”¨æˆ·å¿…é¡»èƒ½å¤Ÿåº”ç”¨ç°æœ‰çš„AWS VPCç½‘ç»œå’Œå®‰å…¨æœ€ä½³å®è·µï¼Œä»¥é€šè¿‡AWS VPCæ„å»ºKubernetesé›†ç¾¤</li>
<li>åªéœ€å‡ ç§’é’Ÿå³å¯è®¾ç½®Podç½‘ç»œ</li>
<li>ç®¡ç†å‘˜åº”èƒ½å¤Ÿå°†ç¾¤é›†æ‰©å±•åˆ°2000ä¸ªèŠ‚ç‚¹</li>
</ul>
<h4 id="412-æ–¹æ¡ˆ">4.1.2 æ–¹æ¡ˆ</h4>
<ul>
<li>ä¸ºæ¯ä¸ªNode(ec2)åˆ›å»ºå¤šä¸ªå¼¹æ€§ç½‘ç»œæ¥å£(ENIs)ï¼Œå¹¶åˆ†é…secondary IP</li>
<li>å¯¹äºæ¯ä¸ªPodï¼Œé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„secondary IPï¼Œå°†å…¶åˆ†é…ç»™Podï¼Œå¹¶å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š
<ul>
<li>åœ¨å•ä¸ªä¸»æœºä¸Šè¿›è¡ŒPodåˆ°Podçš„é€šä¿¡</li>
<li>åœ¨ä¸åŒä¸»æœºä¸Šè¿›è¡ŒPodåˆ°Podçš„é€šä¿¡</li>
<li>å…è®¸åœ¨Podå’ŒAWSæœåŠ¡è¿›è¡Œé€šä¿¡</li>
<li>å…è®¸Podå’Œæœ¬åœ°æ•°æ®ä¸­å¿ƒè¿›è¡Œé€šä¿¡</li>
<li>å…è®¸Podå’ŒInternetè¿›è¡Œé€šä¿¡</li>
</ul>
</li>
</ul>
<blockquote>
<p>åœ¨EC2-VPCé‡Œï¼Œæ¯ä¸ªå®ä¾‹å¯ä»¥åˆ›å»ºå¤šä¸ªENIï¼Œæ¯ä¸ªENIå¯ä»¥åˆ†é…å¤šä¸ªIPåœ°å€ã€‚ ä»»ä½•å‘å¾€è¿™äº›IPåœ°å€ä¹‹ä¸€çš„æ•°æ®åŒ…ï¼ŒEC2-VPCéƒ½ä¼šå°†è¯¥æ•°æ®åŒ…ä¼ é€’åˆ°å®ä¾‹ã€‚</p>
<p>ENIæ˜¯è™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œæ‚¨å¯ä»¥å°†å…¶é™„åŠ åˆ°VPCä¸­çš„å®ä¾‹ã€‚ å°†ENIé™„åŠ åˆ°å®ä¾‹åï¼Œå°†åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ¥å£ã€‚ ä¸»ENI IPåœ°å€ä¼šè‡ªåŠ¨åˆ†é…ç»™è¯¥æ¥å£ã€‚ æ‰€æœ‰è¾…åŠ©åœ°å€å‡æœªåˆ†é…ï¼Œå¹¶ä¸”ç”±ä¸»æœºæ‰€æœ‰è€…å†³å®šå¦‚ä½•é…ç½®å®ƒä»¬ã€‚</p>
</blockquote>
<h4 id="413-æ¶æ„">4.1.3 æ¶æ„</h4>
<p><strong>Pod to Pod</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="wire-network.png"
        data-srcset="/k8s_series_network/wire-network.png, wire-network.png 1.5x, /k8s_series_network/wire-network.png 2x"
        data-sizes="auto"
        alt="/k8s_series_network/wire-network.png"
        title="img" /></p>
<hr>
<p><strong>Inside a Pod</strong></p>
<p>IP address</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ip addr show</span>
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
3: eth0@if173: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">9001</span> qdisc noqueue state UP group default
    link/ether 6a:f3:a1:ff:38:a8 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="m">0</span>
    inet 172.31.176.184/32 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre></td></tr></table>
</div>
</div><p>route</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ip route show</span>
default via 169.254.1.1 dev eth0
169.254.1.1 dev eth0 scope link
</code></pre></td></tr></table>
</div>
</div><p>static arp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># arp -a</span>
172-31-177-243.node-exporter.monitoring.svc.cluster.local <span class="o">(</span>172.31.177.243<span class="o">)</span> at 8e:6b:e1:80:7c:de <span class="o">[</span>ether<span class="o">]</span> on eth0
_gateway <span class="o">(</span>169.254.1.1<span class="o">)</span> at 8e:6b:e1:80:7c:de <span class="o">[</span>ether<span class="o">]</span> PERM on eth0
</code></pre></td></tr></table>
</div>
</div><p><strong>On Host side</strong></p>
<p>ip address</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ip addr show</span>
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">9001</span> qdisc mq state UP group default qlen <span class="m">1000</span>
    link/ether 02:b1:bf:9a:b2:cb brd ff:ff:ff:ff:ff:ff
    inet 172.31.177.243/23 brd 172.31.177.255 scope global dynamic eth0
       valid_lft 2539sec preferred_lft 2539sec
    inet6 fe80::b1:bfff:fe9a:b2cb/64 scope link
       valid_lft forever preferred_lft forever
8: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">9001</span> qdisc mq state UP group default qlen <span class="m">1000</span>
    link/ether 02ğŸ’¿2d:55:75:29 brd ff:ff:ff:ff:ff:ff
    inet 172.31.177.128/23 brd 172.31.177.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80:ğŸ’¿2dff:fe55:7529/64 scope link
       valid_lft forever preferred_lft forever
173: enic614534eb15@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">9001</span> qdisc noqueue state UP group default
    link/ether 8e:6b:e1:80:7c:de brd ff:ff:ff:ff:ff:ff link-netnsid <span class="m">3</span>
    inet6 fe80::8c6b:e1ff:fe80:7cde/64 scope link
       valid_lft forever preferred_lft forever
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡è·¯ç”±è¡¨æ§åˆ¶Podçš„å‡ºå…¥æµé‡</p>
<ul>
<li>
<p>main routeæ§åˆ¶è¿›å…¥podçš„æµé‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ip route show</span>
default via 172.31.176.1 dev eth0
169.254.169.254 dev eth0
172.31.176.0/23 dev eth0 proto kernel scope link src 172.31.177.243
172.31.176.184 dev enic614534eb15 scope link   <span class="c1"># &lt;----- Pod&#39;s IP </span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æ¯ä¸ªENIéƒ½æœ‰è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œè¯¥è·¯ç”±è¡¨ç”¨äºè·¯ç”±Podçš„ä¼ å‡ºæµé‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ip route show table 2</span>
default via 172.31.176.1 dev eth1
172.31.176.1 dev eth1 scope link
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>éœ€è¦ç»™pod ipé…ç½®ç­–ç•¥è·¯ç”±ï¼Œå¦åˆ™æµé‡æ— æ³•èµ°åˆ°ENIçš„è·¯ç”±è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ip rule list</span>
0:	from all lookup <span class="nb">local</span>
512:	from all to 172.31.176.184 lookup main  --&gt; åˆ°Podçš„æµé‡èµ°é»˜è®¤è·¯ç”±è¡¨
1024:	from all fwmark 0x80/0x80 lookup main
1536:	from 172.31.176.184 lookup <span class="m">2</span>            --&gt; ä»Podå‡ºæ¥çš„æµé‡èµ°ENIè‡ªå·±çš„è·¯ç”±è¡¨     
32766:	from all lookup main
32767:	from all lookup default
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="414-cniæ’ä»¶æ‰§è¡Œçš„æ“ä½œ">4.1.4 CNIæ’ä»¶æ‰§è¡Œçš„æ“ä½œ</h4>
<ul>
<li>
<p>åˆ›å»ºveth pairï¼Œä¸€ä¸ªæ”¾åˆ°ä¸»æœºçš„namespaceï¼Œä¸€ä¸ªæ”¾åˆ°Podâ€™s namespace</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">ip link add veth-1 type veth peer name veth-1c  /* on host namespace <span class="ge">*/
</span><span class="ge">ip link set veth-1c netns ns1  /*</span> move veth-1c to Pod&#39;s namespace ns1 <span class="ge">*/
</span><span class="ge">ip link set veth-1 up /*</span> bring up veth-1 <span class="ge">*/
</span><span class="ge">ip netns exec ns1 ip link set veth-1c up /*</span> bring up veth-1c */
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è·å–åˆ†é…ç»™å®ä¾‹çš„secondary IPåœ°å€ï¼Œå¹¶åœ¨Podçš„namespaceä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>åˆ†é…IPç»™Podçš„eth0</li>
<li>æ·»åŠ é»˜è®¤ç½‘å…³å’Œé»˜è®¤è·¯ç”±åˆ°Podçš„è·¯ç”±è¡¨</li>
<li>ç»™é»˜è®¤ç½‘å…³æ·»åŠ é™æ€ARPæ¡ç›®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">/* To assign IP address 172.31.176.184 to Pod&#39;s namespace ns1 <span class="ge">*/
</span><span class="ge"> ip netns exec ns1 ip addr add 172.31.176.184/32 dev veth-1c /*</span> assign a IP address to veth-1c <span class="ge">*/
</span><span class="ge"> ip netns exec ns1 ip route add 169.254.1.1 dev veth-1c /*</span> add default gateway <span class="ge">*/ 
</span><span class="ge"> ip netns exec ns1 ip route add default via 169.254.1.1 dev veth-1c /*</span> add default route <span class="ge">*/
</span><span class="ge">    
</span><span class="ge"> ip netns exec ns1 arp -i veth-1c -s 169.254.1.1 &lt;veth-1&#39;s mac&gt; /*</span> add static ARP entry for default gateway */
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>åœ¨ä¸»æœºä¸Šæ·»åŠ åˆ°Podçš„è·¯ç”±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">/* Pod&#39;s IP address is 172.31.176.184 <span class="ge">*/
</span><span class="ge"> ip route add 172.31.176.184/32 dev veth-1 /*</span> add host route */
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="415-æµé‡è¿‡ç¨‹">4.1.5 æµé‡è¿‡ç¨‹</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown"><span class="gh">#ä»¥172.31.176.184ä¸ºä¾‹è¯´æ˜node1&#39;s pod1 to node2&#39;s pod2çš„æµé‡å‘å‡ºè¿‡ç¨‹
</span><span class="gh"></span><span class="k">1.</span> pod1çš„é»˜è®¤å‡ºå£ä¸º169.254.1.1(macåœ°å€ä¸ºveth pairçš„å¦ä¸€ç«¯)
<span class="k">2.</span> åŒ¹é…ç­–ç•¥è·¯ç”±from 172.31.176.184 lookup 2
<span class="k">3.</span> åŒ¹é…è·¯ç”±è¡¨2 default via 172.31.176.1 dev eth1ï¼Œæµé‡ä»node1çš„eth1å‡ºå£å‡ºå»
<span class="k">4.</span> EC2-VPCæµé‡è½¬å‘åˆ°node2çš„ethX

<span class="gh">#é€šè¿‡172.31.176.184ä¸ºä¾‹è§£é‡Šnode2&#39;s pod2çš„æ¥æ”¶è¿‡ç¨‹
</span><span class="gh"></span><span class="k">5.</span> æµé‡è¿›å…¥node2çš„eth1æ¥å£
<span class="k">6.</span> åŒ¹é…ç­–ç•¥è·¯ç”±from all to 172.31.176.184 lookup main
<span class="k">7.</span> åŒ¹é…è·¯ç”±è¡¨main 172.31.176.184 dev enic614534eb15 scope link,æµé‡å‘å¾€enic614534eb15æ¥å£
<span class="k">8.</span> é€šè¿‡veth pairä¼ è¾“ç»™pod2
</code></pre></td></tr></table>
</div>
</div><p><strong>Pod To Pod</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="pod-pod.png"
        data-srcset="/k8s_series_network/pod-pod.png, pod-pod.png 1.5x, /k8s_series_network/pod-pod.png 2x"
        data-sizes="auto"
        alt="/k8s_series_network/pod-pod.png"
        title="/k8s_series_network/pod-pod.png" /></p>
<p>**Pod To External **</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cctrip.github.io/notes/docs/technology/cloud/container/kubernetes/network/aws/pod-external.png"
        data-srcset="https://cctrip.github.io/notes/docs/technology/cloud/container/kubernetes/network/aws/pod-external.png, https://cctrip.github.io/notes/docs/technology/cloud/container/kubernetes/network/aws/pod-external.png 1.5x, https://cctrip.github.io/notes/docs/technology/cloud/container/kubernetes/network/aws/pod-external.png 2x"
        data-sizes="auto"
        alt="https://cctrip.github.io/notes/docs/technology/cloud/container/kubernetes/network/aws/pod-external.png"
        title="img" /></p>
<p><strong>AWS_VPC_K8S_CNI_EXTERNALSNAT = False</strong></p>
<p>ä½¿ç”¨iptables SNATè§„åˆ™ï¼Œå°†pod ipè½¬æ¢æˆä¸»ENIçš„ä¸»IPåœ°å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">-A POSTROUTING ! -d &lt;VPC-CIDR&gt; -m comment --comment &#34;kubenetes: SNAT for outbound traffic from cluster&#34; -m addrtype ! --dst-typ
</code></pre></td></tr></table>
</div>
</div><p><strong>AWS_VPC_K8S_CNI_EXTERNALSNAT = True</strong></p>
<p>å½“å°†SNATåŠŸèƒ½å…³é—­åï¼Œæ— æ³•é€šè¿‡ä¸»ENIçš„ä¸»IPåœ°å€åšå¤–ç½‘æ˜ å°„ï¼Œæ­¤æ—¶éœ€è¦ç»™å¯¹åº”çš„ENIçš„ä¸»IPåœ°å€é…ç½®å¯¹åº”çš„å¤–ç½‘IPï¼Œæˆ–è€…ç»™å­ç½‘é…ç½®é»˜è®¤ç½‘å…³</p>
<hr>
<h2 id="5-ç»“è®º">5. ç»“è®º</h2>
<p>è¯¥ç¯‡æˆ‘ä»¬äº†è§£äº†k8sç½‘ç»œçš„å®ç°æ–¹å¼ï¼Œä»¥åŠCNIæ’ä»¶å…·å¤‡çš„åŠŸèƒ½ï¼Œå¹¶äº†è§£äº†ä¸€äº›ä¸»æµçš„CNIç½‘ç»œæ–¹æ¡ˆã€‚</p>
<hr>
<p><strong>å‚è€ƒ</strong></p>
<p><a href="https://github.com/containernetworking/cni">https://github.com/containernetworking/cni</a></p>
<p><a href="https://sookocheff.com/post/kubernetes/understanding-kubernetes-networking-model/">https://sookocheff.com/post/kubernetes/understanding-kubernetes-networking-model/</a></p>
<p><a href="https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md">https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-10-30</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/k8s_series_network/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://cctrip.github.io/k8s_series_network/" data-title="Kubernetesç³»åˆ—ï¼šç½‘ç»œ" data-via="https://twitter.com/zcc0388" data-hashtags="kubernetes"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://cctrip.github.io/k8s_series_network/" data-hashtag="kubernetes"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://cctrip.github.io/k8s_series_network/" data-title="Kubernetesç³»åˆ—ï¼šç½‘ç»œ"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://cctrip.github.io/k8s_series_network/" data-title="Kubernetesç³»åˆ—ï¼šç½‘ç»œ"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="Share on å¾®åš" data-sharer="weibo" data-url="https://cctrip.github.io/k8s_series_network/" data-title="Kubernetesç³»åˆ—ï¼šç½‘ç»œ"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/kubernetes/">kubernetes</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/k8s_series_container/" class="prev" rel="prev" title="Kubernetesç³»åˆ—ï¼šå®¹å™¨"><i class="fas fa-angle-left fa-fw"></i>Kubernetesç³»åˆ—ï¼šå®¹å™¨</a>
            <a href="/k8s_series_storage/" class="next" rel="next" title="Kubernetesç³»åˆ—ï¼šå­˜å‚¨">Kubernetesç³»åˆ—ï¼šå­˜å‚¨<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.81.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">xxxx</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{"gitalk":{"admin":["cctrip"],"clientID":"942595e10fb5f8b4195b","clientSecret":"1a2be1fbb13b403433d83de555a653f840a9dd91","id":"2020-10-30T17:55:28+08:00","owner":"cctrip","repo":"comment","title":"Kubernetesç³»åˆ—ï¼šç½‘ç»œ"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"algoliaAppID":"L6D88CPUCA","algoliaIndex":"hugo","algoliaSearchKey":"994528be64a6348310adaf32dff5bc6c","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
